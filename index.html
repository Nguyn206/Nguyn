<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Ch·ªß - E-commerce Demo Ho√†n Ch·ªânh</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        /* Thi·∫øt l·∫≠p c∆° b·∫£n */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
        }

        /* C·∫•u tr√∫c Layout Ch√≠nh */
        .main-content-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 20px 0;
        }

        /* --- 1. HEADER CSS --- */
        .main-header {
            background-color: #f77f00;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .main-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            background-image:
                radial-gradient(white 1px, transparent 0),
                radial-gradient(white 1px, transparent 0),
                radial-gradient(white 2px, transparent 0);
            background-size: 50px 50px, 70px 70px, 90px 90px;
            background-position: 0 0, 15px 15px, 30px 30px;
            animation: snowfall 10s linear infinite;
        }
        @keyframes snowfall {
            from { background-position: 0 0, 15px 15px, 30px 30px; }
            to { background-position: 0 100%, 15px 115px, 30px 130px; }
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 10px 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 20;
        }
        .header-top { display: flex; align-items: center; justify-content: flex-end; width: 100%; margin-bottom: 5px; }
        .header-bottom { display: flex; align-items: center; width: 100%; justify-content: space-between; }
        .logo { width: 100px; display: flex; align-items: center; }
        .logo img { height: 40px; width: auto; vertical-align: middle; filter: drop-shadow(1px 1px 2px rgba(0,0,0,0.5)); }
        .search-container-wrapper { flex-grow: 1; display: flex; justify-content: center; }
        .search-bar-container { width: 450px; }
        .search-form { display: flex; background-color: white; border-radius: 4px; overflow: hidden; border: 1px solid #ccc; }
        .search-input { flex-grow: 1; padding: 8px 10px; border: none; outline: none; font-size: 14px; }
        .search-button { background-color: white; color: #333; border: none; padding: 8px 15px; cursor: pointer; font-size: 16px; }
        .cart-wrapper { width: 100px; display: flex; justify-content: center; align-items: center; }
        .cart-icon { color: white; font-size: 28px; text-decoration: none; position: relative; }
        .cart-icon:hover { opacity: 0.8; }
        .cart-icon.active-cart {
            color: yellow;
        }

        .header-nav { display: flex; align-items: center; gap: 15px; color: white; }
        .nav-item, .auth-links a, #userProfileArea a {
            color: white;
            text-decoration: none;
            font-size: 14px;
            font-weight: bold;
            white-space: nowrap;
            cursor: pointer;
        }
        .nav-item:hover, .auth-links a:hover, #userProfileArea a:hover {
            text-decoration: underline;
            color: #fff;
        }

        /* --- 2. MODAL & SETTINGS CSS --- */

        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4); justify-content: center; align-items: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 30px; border: 1px solid #888;
            width: 90%; max-width: 400px; border-radius: 8px; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .close-btn { color: #aaa; float: right; font-size: 28px; font-weight: bold; position: absolute;
            top: 10px; right: 15px; }
        .close-btn:hover, .close-btn:focus { color: #000; text-decoration: none; cursor: pointer; }
        .modal-content h2 { margin-bottom: 20px; color: #333; text-align: center; }

        .modal-content label { display: block; margin-top: 15px; }
        .modal-content label:first-child { margin-top: 0; }

        .password-container { position: relative; width: 100%; }

        .password-container input, .modal-content input[type="text"], .modal-content input[type="email"], .modal-content input[type="file"], .modal-content input[type="password"],
        .modal-content input[type="number"], .modal-content select, .modal-content textarea {
            width: 100%;
            padding: 12px; display: inline-block; border: 1px solid #ccc; box-sizing: border-box; border-radius: 4px;
        }
        .password-container input { padding-right: 40px; margin: 0; }
        .toggle-password { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); cursor: pointer;
            color: #666; font-size: 18px; z-index: 10; }
        .modal-content button { background-color: #f77f00;
            color: white; padding: 14px 20px; margin: 15px 0 8px; border: none; cursor: pointer; width: 100%; opacity: 0.9; border-radius: 4px;
            font-size: 16px; font-weight: bold; }
        .switch-form { text-align: center; margin-top: 15px; font-size: 14px; }

        /* SETTINGS CSS */
        .settings-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #ccc;
            display: block;
            margin: 0 auto 15px;
            object-fit: cover;
            border: 3px solid #f77f00;
        }
        .settings-list { list-style: none; padding: 0; }
        .settings-item {
            display: flex;
            justify-content: space-between; align-items: center; padding: 15px 10px;
            border-bottom: 1px solid #eee; cursor: pointer; transition: background-color 0.2s;
        }
        .settings-item:hover { background-color: #fff8f0; }
        .item-info { flex-grow: 1; text-align: left; margin-left: 10px;}
        .item-label { display: block; font-weight: bold; color: #333; }
        .item-value { display: block; font-size: 0.9em; color: #666; }
        .action-buttons { display: flex; gap: 10px; margin-top: 15px; }
        .action-buttons button { width: 50%; margin: 0; padding: 10px; }
        .action-buttons .cancel-btn { background-color: #ccc; }

        /* --- 3. NAVIGATION & ACTIVE STATE --- */
        .category-bar {
            background-color: #ffffff;
            border-bottom: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            width: 100%;
        }
        .category-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: flex-start;
            gap: 40px;
            padding: 10px 20px;
        }
        .category-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 0;
            color: #333;
            text-decoration: none;
            font-size: 16px;
            font-weight: bold;
            border-bottom: 2px solid transparent;
            transition: border-bottom 0.3s, color 0.3s;
            cursor: pointer;
        }

        .category-item i {
            display: inline-block;
            font-size: 18px;
            color: #f77f00;
        }
        .category-item:hover {
            color: #f77f00;
        }
        .category-item.active {
            color: #f77f00;
            border-bottom: 2px solid #f77f00;
        }

        /* --- 4. SLIDER BANNER CSS --- */
        .slider-container {
            position: relative;
            width: 100%;
            height: 350px;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .slides { display: flex; transition: transform 0.5s ease-in-out; height: 100%; }
        .slide { min-width: 100%; position: relative; height: 100%; display: flex; justify-content: center;
            align-items: center; text-align: center; }
        .slide img { width: 100%; height: 100%; object-fit: cover; }
        .slide-caption { position: absolute; bottom: 20px;
            background-color: rgba(0, 0, 0, 0.5); color: white; padding: 10px 20px; border-radius: 5px; font-size: 1.2em; font-weight: bold; }
        .slider-nav button { position: absolute; top: 50%; transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5); color: white; border: none; padding: 15px; cursor: pointer; z-index: 50; font-size: 18px; transition: background 0.3s; }
        .slider-nav button:hover { background: rgba(0, 0, 0, 0.8); }
        .prev-btn { left: 0; border-radius: 0 4px 4px 0; }
        .next-btn { right: 0; border-radius: 4px 0 0 4px; }

        /* --- 5. PRODUCT, ORDER & CART CSS --- */
        .main-section {
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            min-height: 500px;
            display: none;
        }
        .main-section.active {
            display: block;
        }

        /* Product Grid */
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .product-card {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .product-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        .product-info {
            padding: 15px;
            text-align: center;
        }
        .product-info h4 {
            font-size: 1.1em;
            margin-bottom: 8px;
            color: #333;
        }
        .product-price {
            font-size: 1.2em;
            color: #f77f00;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .add-to-cart-btn {
            background-color: #f77f00;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s;
        }
        .add-to-cart-btn:hover {
            background-color: #e66a00;
        }

        /* Product Category Filter CSS (C·∫•p 1) */
        .products-category-filter {
            display: flex;
            justify-content: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 2px solid #f77f00;
            margin-bottom: 10px;
            overflow-x: auto;
        }
        .products-category-filter .category-btn {
            background-color: #f7f7f7;
            color: #333;
            border: 1px solid #ccc;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .products-category-filter .category-btn.active {
            background-color: #f77f00;
            color: white;
            border-color: #f77f00;
            font-weight: bold;
        }
        /* Product Sub-Category Filter CSS (C·∫•p 2) */
        .products-sub-category-filter {
            display: flex;
            justify-content: flex-start;
            gap: 10px;
            padding: 5px 0 15px 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 15px;
            overflow-x: auto;
        }
        .products-sub-category-filter .subcategory-btn {
            background-color: #ffffff;
            color: #666;
            border: 1px solid #e0e0e0;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .products-sub-category-filter .subcategory-btn:hover {
            background-color: #f0f0f0;
        }
        .products-sub-category-filter .subcategory-btn.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
            font-weight: bold;
        }
        /* Order Status Filter CSS */
        .order-status-filter {
            display: flex;
            justify-content: flex-start;
            gap: 10px;
            padding: 10px 0;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
            overflow-x: auto;
        }

        .status-btn {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .status-btn:hover {
            background-color: #e0e0e0;
        }
        .status-btn.active {
            background-color: #f77f00;
            color: white;
            border-color: #f77f00;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        /* Order List */
        .order-list {
            margin-top: 20px;
        }
        .order-item {
            background-color: #f9f9f9;
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        .order-id {
            font-weight: bold;
            color: #555;
        }
        .order-status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 4px;
        }
        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-confirmed { background-color: #d1ecf1; color: #0c5460; }
        .status-ready_to_ship { background-color: #e2e3e5; color: #383d41; }
        .status-shipping { background-color: #cce5ff; color: #004085; }
        .status-delivered { background-color: #d4edda; color: #155724; }
        .status-cancelled { background-color: #f8d7da; color: #721c24; }
        .order-details p {
            margin: 5px 0;
            font-size: 0.9em;
            color: #777;
        }
        .order-details strong { color: #333; }
        .order-total {
            text-align: right;
            font-size: 1.1em;
            font-weight: bold;
            color: #f77f00;
            margin-top: 10px;
        }

        /* Cart Layout */
        .cart-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .cart-table {
            flex-grow: 1;
            width: 70%;
            border-collapse: collapse;
            background-color: #fff;
        }
        .cart-table th, .cart-table td {
            border: 1px solid #eee;
            padding: 15px;
            text-align: center;
        }

        .cart-table th {
            background-color: #f77f00;
            color: white;
            font-weight: bold;
        }
        .item-detail {
            display: flex;
            align-items: center;
            gap: 10px;
            text-align: left;
        }

        .item-detail img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 4px;
        }
        .cart-table input[type="number"] {
            width: 60px;
            padding: 5px;
            text-align: center;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .remove-btn {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            font-size: 18px;
        }
        .remove-btn:hover {
            color: #c0392b;
        }

        /* Cart Summary */
        .cart-summary {
            width: 30%;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            align-self: flex-start;
        }
        .cart-summary h3 {
            border-bottom: 2px solid #f77f00;
            padding-bottom: 10px;
            margin-bottom: 15px;
            color: #333;
        }
        .summary-line {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1em;
        }
        .summary-total {
            border-top: 1px solid #ccc;
            padding-top: 10px;
            margin-top: 10px;
            font-size: 1.2em;
            font-weight: bold;
            color: #f77f00;
        }
        .checkout-btn {
            background-color: #2ecc71;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 4px;
            width: 100%;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        .checkout-btn:hover {
            background-color: #27ae60;
        }
        .continue-shopping-btn {
            background-color: #95a5a6;
            color: white;
            padding: 10px;
            border: none;
            border-radius: 4px;
            width: 100%;
            cursor: pointer;
            margin-top: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        /* Checkout Layout CSS */
        .checkout-layout {
            display: flex;
            gap: 30px;
            margin-top: 20px;
        }
        .shipping-info {
            width: 60%;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .final-summary {
            width: 40%;
            padding: 20px;
            border: 1px solid #f77f00; /* Vi·ªÅn n·ªïi b·∫≠t */
            border-radius: 8px;
            background-color: #fff;
            align-self: flex-start;
        }
        .shipping-info label {
            display: block;
            margin-top: 10px;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        .shipping-info input[type="text"],
        .shipping-info input[type="tel"],
        .shipping-info textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 15px;
        }
        .payment-method label {
            display: block;
            margin-bottom: 10px;
            font-size: 15px;
        }
        .final-summary h3 {
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            margin-bottom: 15px;
            color: #333;
        }

        #checkoutOrderItems {
            max-height: 250px;
            overflow-y: auto;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 10px;
        }

        .checkout-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .checkout-item span:first-child {
            color: #555;
        }
        .checkout-item span:last-child {
            font-weight: bold;
        }

        .cart-table input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* --- Toast Notification CSS --- */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateX(100%);
            transition: opacity 0.3s ease-in-out, transform 0.4s ease-out;
            min-width: 250px;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        .toast.success {
            background-color: #2ecc71;
            /* Xanh l√° */
            border-left: 5px solid #27ae60;
        }
        .toast.warning {
            background-color: #f39c12;
            /* V√†ng cam */
            border-left: 5px solid #e67e22;
        }
        .toast.error {
            background-color: #e74c3c;
            /* ƒê·ªè */
            border-left: 5px solid #c0392b;
        }

        /* --- ADMIN DASHBOARD CSS --- */
        #admin-dashboard-section {
            background-color: #fff;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
            min-height: 80vh;
        }

        .admin-nav-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .admin-nav-btn {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ccc;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s, color 0.2s;
            white-space: nowrap;
        }
        .admin-nav-btn:hover {
            background-color: #e0e0e0;
        }
        .admin-nav-btn.active {
            background-color: #f77f00;
            color: white;
            border-color: #f77f00;
        }

        .admin-content {
            display: none;
            padding: 10px;
        }
        .admin-content.active {
            display: block;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .admin-table th, .admin-table td {
            border: 1px solid #eee;
            padding: 12px;
            text-align: left;
        }
        .admin-table th {
            background-color: #34495e;
            color: white;
            font-size: 14px;
        }
        .admin-table tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .admin-table button {
            padding: 8px 12px;
            margin: 0 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            width: auto;
        }
        .admin-table button.edit-btn { background-color: #3498db; color: white; }
        .admin-table button.delete-btn { background-color: #e74c3c; color: white; }
        .admin-table button:hover { opacity: 0.8; }

        .add-product-btn {
            background-color: #2ecc71;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
            width: auto;
        }
        .add-product-btn:hover {
            background-color: #27ae60;
        }

        /* Order status dropdown in Admin */
        .status-dropdown {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background-color: white;
            cursor: pointer;
            font-weight: bold;
        }

    </style>
</head>
<body>
    <div id="toast-container">
    </div>

    <header class="main-header">
        <div class="header-container">
            <div class="header-top">
                <nav class="header-nav">
                    <a href="#" class="nav-item"> Th√¥ng B√°o </a>
                    <a href="#" class="nav-item"> Tr·ª£ Gi√∫p </a>

                    <span class="nav-item auth-links" id="authLinks">
                        <a onclick="openRegisterModal()"> ƒêƒÉng K√Ω </a>  |
                        <a onclick="openLoginModal()"> ƒêƒÉng Nh·∫≠p </a>
                    </span>

                    <span class="nav-item user-profile-area" id="userProfileArea" style="display: none; gap: 15px;">
                        <a href="#" class="nav-item" style="color: yellow; font-weight: normal;"
                            id="welcomeUserText"></a>
                        <a href="#" class="profile-avatar" onclick="openProfileModal()">
                            <i class="fas fa-user-circle" style="font-size: 24px;"></i>
                        </a>
                        <a href="#" class="nav-item" onclick="handleLogout()"> ƒêƒÉng Xu·∫•t </a>
                    </span>
                </nav>
            </div>

            <div class="header-bottom">
                <div class="logo">
                    <img src="https://www.photoroom.com/vi/cac-cong-cu/bo-dien-canh" alt="Logo C√¥ng ty">
                </div>

                <div class="search-container-wrapper">
                    <div class="search-bar-container">
                        <form class="search-form" onsubmit="return handleSearch(event)">
                            <input type="text" placeholder="T√¨m s·∫£n ph·∫©m" class="search-input" id="searchInput">
                            <button type="submit" class="search-button">
                                <i class="fas fa-search"></i>
                            </button>
                        </form>
                    </div>
                </div>

                <div class="cart-wrapper">
                    <a href="#" class="cart-icon" id="header-cart-icon" onclick="showCart()">
                        <i class="fas fa-shopping-cart"></i>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <nav class="category-bar">
        <div class="category-container">
            <a id="nav-home" class="category-item active" onclick="showContent('home-section', this)">
                <i class="fas fa-store"></i>
                Th√¥ng Tin V·ªÅ C·ª≠a H√†ng
            </a>
            <a id="nav-products" class="category-item" onclick="showContent('products-section', this)">
                <i class="fas fa-box"></i>
                S·∫£n Ph·∫©m
            </a>
            <a id="nav-orders" class="category-item" onclick="showContent('orders-section', this)">
                <i class="fas fa-receipt"></i>
                ƒê∆°n H√†ng
            </a>
        </div>
    </nav>

    <main class="main-content-container">

        <div class="slider-container">
            <div class="slides" id="imageSlider">
                <div class="slide">
                    <img src="https://via.placeholder.com/1200x350/FFC300/FFFFFF?text=DEAL+HOT+TRONG+NGAY" alt="Banner 1">
                    <div class="slide-caption"> Gi·∫£m gi√° l√™n ƒë·∫øn 50% </div>
                </div>
                <div class="slide">
                    <img src="https://via.placeholder.com/1200x350/2C3E50/FFFFFF?text=S·∫¢N+PH·∫®M+M·ªöI+V·ªÄ" alt="Banner 2">
                    <div class="slide-caption"> Kh√°m ph√° b·ªô s∆∞u t·∫≠p m·ªõi nh·∫•t </div>
                </div>
                <div class="slide">
                    <img src="https://via.placeholder.com/1200x350/F77F00/FFFFFF?text=MI·ªÑN+PH√ç+V·∫¨N+CHUY·ªÇN" alt="Banner 3">
                    <div class="slide-caption"> √Åp d·ª•ng cho m·ªçi ƒë∆°n h√†ng t·ª´ 500K </div>
                </div>
            </div>
            <div class="slider-nav">
                <button class="prev-btn" onclick="moveSlider(-1)">‚ùÆ</button>
                <button class="next-btn" onclick="moveSlider(1)">‚ùØ</button>
            </div>
        </div>

        <section id="home-section" class="main-section active">
            <h2> üè† Th√¥ng Tin V·ªÅ C·ª≠a H√†ng </h2>
            <p style="margin-top: 15px;"> Ch√†o m·ª´ng ƒë·∫øn v·ªõi c·ª≠a h√†ng demo!
                ...</p>
        </section>

        <section id="products-section" class="main-section">
            <div class="products-category-filter" id="productsCategoryFilter">
                </div>
            <div class="products-sub-category-filter" id="productsSubCategoryFilter">
                </div>
            <h2> Danh S√°ch S·∫£n Ph·∫©m </h2>
            <div class="product-grid" id="productGrid">
                </div>
        </section>

        <section id="cart-section" class="main-section">
            <h2> üõí Gi·ªè H√†ng C·ªßa T√¥i </h2>
            <div class="cart-container">
                <table class="cart-table" id="cartTable">
                    <thead>
                        <tr>
                            <th style="width: 50px;"><input type="checkbox" id="checkAllCartItems" onchange="toggleSelectAll(this.checked)"></th>
                            <th style="text-align: left;">S·∫£n Ph·∫©m</th>
                            <th style="width: 120px;">Gi√°</th>
                            <th style="width: 100px;">S·ªë L∆∞·ª£ng</th>
                            <th style="width: 150px;">T·ªïng C·ªông</th>
                            <th style="width: 80px;">X√≥a</th>
                        </tr>
                    </thead>
                    <tbody id="cartItemsContainer">
                        </tbody>
                </table>
                <div class="cart-summary">
                    <h3> T√≥m T·∫Øt ƒê∆°n H√†ng </h3>
                    <div class="summary-line">
                        <span> T·∫°m t√≠nh (<span id="totalItemsSummary">0</span> s·∫£n ph·∫©m ƒë∆∞·ª£c ch·ªçn): </span>
                        <span id="subtotalSummary">0 VNƒê</span>
                    </div>
                    <div class="summary-line">
                        <span> Ph√≠ v·∫≠n chuy·ªÉn: </span>
                        <span>30.000 VNƒê</span>
                    </div>
                    <div class="summary-line summary-total">
                        <span> T·ªîNG C·ªòNG: </span>
                        <span id="grandTotalSummary">30.000 VNƒê</span>
                    </div>
                    <button class="checkout-btn" onclick="showCheckout()">
                        TI·∫æN H√ÄNH THANH TO√ÅN
                    </button>
                    <button class="continue-shopping-btn" onclick="showContent('products-section', document.getElementById('nav-products'))">
                        <i class="fas fa-chevron-left"></i> Ti·∫øp T·ª•c Mua S·∫Øm
                    </button>
                </div>
            </div>
        </section>

        <section id="checkout-section" class="main-section">
            <h2> üìù Ho√†n T·∫•t ƒê∆°n H√†ng </h2>
            <div class="checkout-layout">
                <div class="shipping-info">
                    <h3> 1. Th√¥ng Tin V·∫≠n Chuy·ªÉn </h3>
                    <form id="shippingForm" onsubmit="return false;">
                        <label for="recipientName"> H·ªç v√† T√™n ng∆∞·ªùi nh·∫≠n </label>
                        <input type="text" id="recipientName" required placeholder="Nh·∫≠p t√™n ng∆∞·ªùi nh·∫≠n">

                        <label for="recipientPhone"> S·ªë ƒêi·ªán Tho·∫°i </label>
                        <input type="tel" id="recipientPhone" required placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">

                        <label for="shippingAddress"> ƒê·ªãa Ch·ªâ Giao H√†ng </label>
                        <textarea id="shippingAddress" rows="3" required placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ chi ti·∫øt"></textarea>

                        <h3 style="margin-top: 30px;"> 2. Ph∆∞∆°ng Th·ª©c Thanh To√°n </h3>
                        <div class="payment-method">
                            <label><input type="radio" name="payment" value="COD" checked> Thanh to√°n khi nh·∫≠n h√†ng (COD) </label><br>
                            <label><input type="radio" name="payment" value="Bank"> Chuy·ªÉn kho·∫£n ng√¢n h√†ng </label>
                        </div>
                    </form>
                </div>
                <div class="final-summary">
                    <h3> 3. Chi Ti·∫øt ƒê∆°n H√†ng </h3>
                    <div id="checkoutOrderItems">
                        <p style="text-align: center; color: #999;"> Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o ƒë∆∞·ª£c ch·ªçn. </p>
                    </div>
                    <div class="summary-line" style="margin-top: 20px;">
                        <span> T·∫°m t√≠nh (<span id="totalItemsCheckout">0</span> s·∫£n ph·∫©m): </span>
                        <span id="subtotalCheckout">0 VNƒê</span>
                    </div>
                    <div class="summary-line">
                        <span> Ph√≠ v·∫≠n chuy·ªÉn: </span>
                        <span id="shippingCheckout">30.000 VNƒê</span>
                    </div>
                    <div class="summary-line summary-total">
                        <span> T·ªîNG THANH TO√ÅN: </span>
                        <span id="grandTotalCheckout">30.000 VNƒê</span>
                    </div>
                    <button class="checkout-btn" style="background-color: #f77f00;" onclick="placeOrder()">
                        HO√ÄN T·∫§T ƒê·∫∂T H√ÄNG
                    </button>
                </div>
            </div>
        </section>

        <section id="orders-section" class="main-section">
            <h2> üì¶ L·ªãch S·ª≠ ƒê∆°n H√†ng </h2>
            <div class="order-status-filter" id="userOrderStatusFilter">
                <button class="status-btn active" data-status="all" onclick="filterOrders('all', this)"> T·∫•t C·∫£ </button>
                <button class="status-btn" data-status="pending" onclick="filterOrders('pending', this)"> Ch·ªù x√°c nh·∫≠n </button>
                <button class="status-btn" data-status="confirmed" onclick="filterOrders('confirmed', this)"> ƒê√£ x√°c nh·∫≠n </button>
                <button class="status-btn" data-status="shipping" onclick="filterOrders('shipping', this)"> ƒêang giao h√†ng </button>
                <button class="status-btn" data-status="delivered" onclick="filterOrders('delivered', this)"> ƒê√£ giao h√†ng </button>
                <button class="status-btn" data-status="cancelled" onclick="filterOrders('cancelled', this)"> ƒê√£ h·ªßy </button>
            </div>
            <div class="order-list" id="orderListContainer">
                </div>
        </section>

        <section id="admin-dashboard-section" class="main-section">
            <h2 style="color: #F77F00;"><i class="fas fa-tools"></i> B·∫£ng ƒêi·ªÅu Khi·ªÉn Admin</h2>
            <hr style="margin-bottom: 20px;">
            <div class="admin-nav-bar">
                <button class="admin-nav-btn active" data-target="admin-orders" onclick="showAdminContent('admin-orders', this)"> Qu·∫£n l√Ω ƒê∆°n H√†ng </button>
                <button class="admin-nav-btn" data-target="admin-products" onclick="showAdminContent('admin-products', this)"> Qu·∫£n l√Ω H√†ng H√≥a </button>
                <button class="admin-nav-btn" data-target="admin-users" onclick="showAdminContent('admin-users', this)"> Qu·∫£n l√Ω Kh√°ch H√†ng </button>
                <button class="admin-nav-btn" data-target="admin-store-info" onclick="showAdminContent('admin-store-info', this)"> Th√¥ng tin C·ª≠a H√†ng </button>
            </div>
            <div id="admin-content-container">

                <div id="admin-orders" class="admin-content active">
                    <h3> Danh S√°ch ƒê∆°n H√†ng </h3>
                    <div class="order-status-filter" id="adminOrderStatusFilter">
                        <button class="status-btn active" data-status="all" onclick="filterAdminOrders('all', this)"> T·∫•t C·∫£ </button>
                        <button class="status-btn" data-status="pending" onclick="filterAdminOrders('pending', this)"> Ch·ªù x√°c nh·∫≠n </button>
                        <button class="status-btn" data-status="confirmed" onclick="filterAdminOrders('confirmed', this)"> ƒê√£ x√°c nh·∫≠n </button>
                        <button class="status-btn" data-status="ready_to_ship" onclick="filterAdminOrders('ready_to_ship', this)"> ƒêang ƒë√≥ng g√≥i </button>
                        <button class="status-btn" data-status="shipping" onclick="filterAdminOrders('shipping', this)"> ƒêang giao h√†ng </button>
                        <button class="status-btn" data-status="delivered" onclick="filterAdminOrders('delivered', this)"> ƒê√£ giao h√†ng </button>
                        <button class="status-btn" data-status="cancelled" onclick="filterAdminOrders('cancelled', this)"> ƒê√£ h·ªßy </button>
                    </div>
                    <div id="adminOrderListContainer">
                        </div>
                </div>

                <div id="admin-products" class="admin-content">
                    <h3> Qu·∫£n l√Ω S·∫£n Ph·∫©m </h3>
                    <button class="add-product-btn" onclick="openProductModal('add')">
                        <i class="fas fa-plus-circle"></i> Th√™m S·∫£n Ph·∫©m M·ªõi
                    </button>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th style="width: 50px;">ID</th>
                                <th style="width: 70px;">·∫¢nh</th>
                                <th>T√™n S·∫£n Ph·∫©m</th>
                                <th style="width: 150px;">Danh M·ª•c</th>
                                <th style="width: 120px;">Gi√°</th>
                                <th style="width: 150px;">Thao T√°c</th>
                            </tr>
                        </thead>
                        <tbody id="adminProductTableBody">
                            </tbody>
                    </table>
                </div>

                <div id="admin-users" class="admin-content">
                    <h3> Danh S√°ch Kh√°ch H√†ng </h3>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th style="width: 50px;">STT</th>
                                <th style="width: 120px;">Username</th>
                                <th>T√™n ƒê·∫ßy ƒê·ªß</th>
                                <th style="width: 250px;">Email</th>
                                <th style="width: 200px;">Thao T√°c</th>
                            </tr>
                        </thead>
                        <tbody id="adminUserTableBody">
                            </tbody>
                    </table>
                </div>

                <div id="admin-store-info" class="admin-content">
                    <h3> Qu·∫£n l√Ω Th√¥ng Tin C·ª≠a H√†ng </h3>
                    <form id="storeInfoForm" onsubmit="return handleUpdateStoreInfo(event)">
                        <label for="storeName"> T√™n C·ª≠a H√†ng </label>
                        <input type="text" id="storeName" value="E-commerce Demo Shop" required>

                        <label for="storeHotline"> Hotline </label>
                        <input type="tel" id="storeHotline" value="0800 123 456" required>

                        <label for="storeAddress"> ƒê·ªãa Ch·ªâ </label>
                        <textarea id="storeAddress" rows="3">123 ƒê∆∞·ªùng C√¥ng Ngh·ªá, Qu·∫≠n ƒê·ªïi M·ªõi, TP. Th√¥ng Minh</textarea>

                        <button type="submit" style="width: 250px; margin-top: 20px; background-color: #3498db;">
                            <i class="fas fa-save"></i> L∆∞u Th√¥ng Tin C·ª≠a H√†ng
                        </button>
                    </form>
                </div>

            </div>
        </section>

    </main>

    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeLoginModal()">√ó</span>
            <h2> ƒêƒÉng Nh·∫≠p üîë </h2>
            <form id="loginForm" onsubmit="return handleLogin(event)">
                <label for="username"><b> T√™n ƒêƒÉng Nh·∫≠p ho·∫∑c Email </b></label>
                <input type="text" placeholder="Nh·∫≠p T√™n ƒêƒÉng Nh·∫≠p ho·∫∑c Email" name="username" id="loginUsername" required>

                <label for="password"><b> M·∫≠t kh·∫©u </b></label>
                <div class="password-container">
                    <input type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" name="password" id="loginPassword" required>
                    <span class="toggle-password" onclick="togglePassword('loginPassword', this)">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>

                <p id="loginMessage" style="color: red; margin-top: 10px; text-align: center;"></p>

                <button type="submit"> ƒêƒÉng Nh·∫≠p </button>
            </form>
            <div class="switch-form">
                Ch∆∞a c√≥ t√†i kho·∫£n? <a onclick="switchToRegister()"> ƒêƒÉng k√Ω ngay </a>
            </div>
        </div>
    </div>

    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeRegisterModal()">√ó</span>
            <h2> ƒêƒÉng K√Ω T√†i Kho·∫£n üìù </h2>
            <form id="registerForm" onsubmit="return handleRegister(event)">

                <label for="reg_name"><b> T√™n ƒê·∫ßy ƒê·ªß </b></label>
                <input type="text" placeholder="Nh·∫≠p t√™n ƒë·∫ßy ƒë·ªß" name="reg_name" required>

                <label for="reg_phone"><b> S·ªë ƒêi·ªán Tho·∫°i </b></label>
                <input type="tel" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" name="reg_phone" required>

                <label for="reg_email"><b> Email </b></label>
                <input type="email" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ email" name="reg_email" required>

                <label for="reg_username"><b> T√™n ƒêƒÉng Nh·∫≠p </b></label>
                <input type="text" placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p" name="reg_username" required>

                <label for="reg_password"><b> M·∫≠t Kh·∫©u </b></label>
                <div class="password-container">
                    <input type="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" name="reg_password" id="regPassword" required>
                    <span class="toggle-password" onclick="togglePassword('regPassword', this)">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>

                <p id="registerMessage" style="color: red; margin-top: 10px; text-align: center;"></p>

                <button type="submit"> ƒêƒÉng K√Ω </button>
            </form>
            <div class="switch-form">
                ƒê√£ c√≥ t√†i kho·∫£n? <a onclick="switchToLogin()"> ƒêƒÉng nh·∫≠p ngay </a>
            </div>
        </div>
    </div>

    <div id="profileModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="close-btn" onclick="closeProfileModal()">√ó</span>
            <h2 style="text-align: left;"><i class="fas fa-cogs"></i> C√†i ƒê·∫∑t T√†i Kho·∫£n </h2>
            <hr style="margin-bottom: 20px; border-color: #f0f0f0;">

            <img id="displayNameSettings" class="settings-avatar" src="" alt="Avatar">
            <p style="text-align: center; font-size: 1.2em; font-weight: bold; margin-bottom: 20px;">
                <span id="displayNameSettings"></span>
                <span id="isAdminBadge" style="background-color: #f77f00; color: white; padding: 2px 6px; font-size: 0.7em; border-radius: 4px; vertical-align: middle; display: none;">ADMIN</span>
            </p>

            <ul class="settings-list">
                <li class="settings-item" onclick="openChangeUsernameModal()">
                    <div class="item-icon"><i class="fas fa-user"></i></div>
                    <div class="item-info">
                        <span class="item-label"> T√™n ƒêƒÉng Nh·∫≠p </span>
                        <span class="item-value" id="currentUsername"></span>
                    </div>
                    <div class="item-action"><i class="fas fa-chevron-right"></i></div>
                </li>
                <li class="settings-item" onclick="openChangeNameModal()">
                    <div class="item-icon"><i class="fas fa-id-card"></i></div>
                    <div class="item-info">
                        <span class="item-label"> T√™n </span>
                        <span class="item-value" id="currentName"></span>
                    </div>
                    <div class="item-action"><i class="fas fa-chevron-right"></i></div>
                </li>
                <li class="settings-item" onclick="openChangeAvatarModal()">
                    <div class="item-icon"><i class="fas fa-camera"></i></div>
                    <div class="item-info">
                        <span class="item-label"> ·∫¢nh ƒê·∫°i Di·ªán </span>
                        <span class="item-value"> Thay ƒë·ªïi ·∫£nh ƒë·∫°i di·ªán </span>
                    </div>
                    <div class="item-action"><i class="fas fa-chevron-right"></i></div>
                </li>
                <li class="settings-item" onclick="openChangePhoneModal()">
                    <div class="item-icon"><i class="fas fa-phone"></i></div>
                    <div class="item-info">
                        <span class="item-label"> S·ªë ƒêi·ªán Tho·∫°i </span>
                        <span class="item-value" id="currentPhone"></span>
                    </div>
                    <div class="item-action"><i class="fas fa-chevron-right"></i></div>
                </li>
                <li class="settings-item" onclick="openChangeEmailModal()">
                    <div class="item-icon"><i class="fas fa-envelope"></i></div>
                    <div class="item-info">
                        <span class="item-label"> Gmail </span>
                        <span class="item-value" id="currentEmail"></span>
                    </div>
                    <div class="item-action"><i class="fas fa-chevron-right"></i></div>
                </li>
                <li class="settings-item" onclick="openChangePasswordModal()">
                    <div class="item-icon"><i class="fas fa-lock"></i></div>
                    <div class="item-info">
                        <span class="item-label"> M·∫≠t Kh·∫©u </span>
                        <span class="item-value"> Thay ƒë·ªïi m·∫≠t kh·∫©u </span>
                    </div>
                    <div class="item-action"><i class="fas fa-chevron-right"></i></div>
                </li>
            </ul>
        </div>
    </div>

    <div id="changeUsernameModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="close-btn" onclick="closeChangeUsernameModal()">√ó</span>
            <h2> Thay ƒê·ªïi T√™n ƒêƒÉng Nh·∫≠p </h2>
            <form id="formChangeUsername" onsubmit="return handleUpdateUsername(event)">
                <label for="inputNewUsername"><b> T√™n ƒêƒÉng Nh·∫≠p M·ªõi </b></label>
                <input type="text" name="inputNewUsername" id="inputNewUsername" required placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p m·ªõi">

                <label for="inputConfirmPasswordUsername"><b> X√°c Nh·∫≠n M·∫≠t Kh·∫©u Hi·ªán T·∫°i </b></label>
                <div class="password-container">
                    <input type="password" name="inputConfirmPasswordUsername" id="inputConfirmPasswordUsername" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
                    <span class="toggle-password" onclick="togglePassword('inputConfirmPasswordUsername', this)">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>

                <p id="usernameMessage" style="color: red; margin-top: 10px; text-align: center;"></p>

                <div class="action-buttons">
                    <button type="button" class="cancel-btn" onclick="closeChangeUsernameModal()"> H·ªßy </button>
                    <button type="submit"> X√°c Nh·∫≠n Thay ƒê·ªïi </button>
                </div>
            </form>
        </div>
    </div>

    <div id="changeNameModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="close-btn" onclick="closeChangeNameModal()">√ó</span>
            <h2> Thay ƒê·ªïi T√™n Hi·ªÉn Th·ªã </h2>
            <form id="formChangeName" onsubmit="return handleUpdateName(event)">
                <label for="inputNewName"><b> T√™n Hi·ªÉn Th·ªã M·ªõi </b></label>
                <input type="text" name="inputNewName" id="inputNewName" required placeholder="Nh·∫≠p t√™n hi·ªÉn th·ªã m·ªõi">

                <label for="inputConfirmPasswordName"><b> X√°c Nh·∫≠n M·∫≠t Kh·∫©u Hi·ªán T·∫°i </b></label>
                <div class="password-container">
                    <input type="password" name="inputConfirmPasswordName" id="inputConfirmPasswordName" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
                    <span class="toggle-password" onclick="togglePassword('inputConfirmPasswordName', this)">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>

                <div class="action-buttons">
                    <button type="button" class="cancel-btn" onclick="closeChangeNameModal()"> H·ªßy </button>
                    <button type="submit"> X√°c Nh·∫≠n Thay ƒê·ªïi </button>
                </div>
            </form>
        </div>
    </div>

    <div id="changeEmailModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="close-btn" onclick="closeChangeEmailModal()">√ó</span>
            <h2> Thay ƒê·ªïi Email </h2>
            <form id="formChangeEmail" onsubmit="return handleUpdateEmail(event)">
                <label for="inputNewEmail"><b> Email M·ªõi </b></label>
                <input type="email" name="inputNewEmail" id="inputNewEmail" required placeholder="Nh·∫≠p email m·ªõi">

                <label for="inputConfirmPasswordEmail"><b> X√°c Nh·∫≠n M·∫≠t Kh·∫©u Hi·ªán T·∫°i </b></label>
                <div class="password-container">
                    <input type="password" name="inputConfirmPasswordEmail" id="inputConfirmPasswordEmail" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
                    <span class="toggle-password" onclick="togglePassword('inputConfirmPasswordEmail', this)">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>

                <p id="emailMessage" style="color: red; margin-top: 10px; text-align: center;"></p>

                <div class="action-buttons">
                    <button type="button" class="cancel-btn" onclick="closeChangeEmailModal()"> H·ªßy </button>
                    <button type="submit"> X√°c Nh·∫≠n Thay ƒê·ªïi </button>
                </div>
            </form>
        </div>
    </div>

    <div id="changePhoneModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="close-btn" onclick="closeChangePhoneModal()">√ó</span>
            <h2> Thay ƒê·ªïi S·ªë ƒêi·ªán Tho·∫°i </h2>
            <form id="formChangePhone" onsubmit="return handleUpdatePhone(event)">
                <label for="inputCurrentPhone"><b> S·ªë ƒêi·ªán Tho·∫°i Hi·ªán T·∫°i </b></label>
                <input type="tel" name="inputCurrentPhone" id="inputCurrentPhone" disabled style="background-color: #f0f0f0;">

                <label for="inputNewPhone"><b> S·ªë ƒêi·ªán Tho·∫°i M·ªõi </b></label>
                <input type="tel" name="inputNewPhone" id="inputNewPhone" required placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i m·ªõi">

                <label for="inputConfirmPasswordPhone"><b> X√°c Nh·∫≠n M·∫≠t Kh·∫©u Hi·ªán T·∫°i </b></label>
                <div class="password-container">
                    <input type="password" name="inputConfirmPasswordPhone" id="inputConfirmPasswordPhone" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
                    <span class="toggle-password" onclick="togglePassword('inputConfirmPasswordPhone', this)">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>

                <p id="phoneMessage" style="color: red; margin-top: 10px; text-align: center;"></p>

                <div class="action-buttons">
                    <button type="button" class="cancel-btn" onclick="closeChangePhoneModal()"> H·ªßy </button>
                    <button type="submit"> X√°c Nh·∫≠n Thay ƒê·ªïi </button>
                </div>
            </form>
        </div>
    </div>

    <div id="changePasswordModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="close-btn" onclick="closeChangePasswordModal()">√ó</span>
            <h2> Thay ƒê·ªïi M·∫≠t Kh·∫©u </h2>
            <form id="formChangePassword" onsubmit="return handleUpdatePassword(event)">
                <label for="inputCurrentPassword"><b> M·∫≠t Kh·∫©u Hi·ªán T·∫°i </b></label>
                <div class="password-container">
                    <input type="password" name="inputCurrentPassword" id="inputCurrentPassword" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i">
                    <span class="toggle-password" onclick="togglePassword('inputCurrentPassword', this)">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>

                <label for="inputNewPassword"><b> M·∫≠t Kh·∫©u M·ªõi </b></label>
                <div class="password-container">
                    <input type="password" name="inputNewPassword" id="inputNewPassword" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u m·ªõi">
                    <span class="toggle-password" onclick="togglePassword('inputNewPassword', this)">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>

                <label for="inputConfirmNewPassword"><b> X√°c Nh·∫≠n M·∫≠t Kh·∫©u M·ªõi </b></label>
                <div class="password-container">
                    <input type="password" name="inputConfirmNewPassword" id="inputConfirmNewPassword" required placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi">
                    <span class="toggle-password" onclick="togglePassword('inputConfirmNewPassword', this)">
                        <i class="fas fa-eye"></i>
                    </span>
                </div>

                <p id="passwordMessage" style="color: red; margin-top: 10px; text-align: center;"></p>

                <div class="action-buttons">
                    <button type="button" class="cancel-btn" onclick="closeChangePasswordModal()"> H·ªßy </button>
                    <button type="submit"> X√°c Nh·∫≠n Thay ƒê·ªïi </button>
                </div>
            </form>
        </div>
    </div>

    <div id="changeAvatarModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <span class="close-btn" onclick="closeChangeAvatarModal()">√ó</span>
            <h2> Thay ƒê·ªïi ·∫¢nh ƒê·∫°i Di·ªán </h2>
            <form id="formChangeAvatar" onsubmit="return handleUpdateAvatar(event)">

                <img id="previewNewAvatar" class="settings-avatar" src="" alt="Avatar Preview">

                <label for="inputNewAvatarUrl"><b> URL ·∫¢nh ƒê·∫°i Di·ªán M·ªõi </b></label>
                <input type="text" name="inputNewAvatarUrl" id="inputNewAvatarUrl" required placeholder="D√°n URL h√¨nh ·∫£nh m·ªõi"
                    oninput="document.getElementById('previewNewAvatar').src = this.value || 'https://via.placeholder.com/100/CCCCCC/808080?text=USER'">

                <p style="color: #999; font-size: 0.9em; margin-top: 10px;">* Ch·ªâ ch·∫•p nh·∫≠n ƒë·ªãnh d·∫°ng URL.</p>

                <div class="action-buttons">
                    <button type="button" class="cancel-btn" onclick="closeChangeAvatarModal()"> H·ªßy </button>
                    <button type="submit"> C·∫≠p Nh·∫≠t </button>
                </div>
            </form>
        </div>
    </div>

    <div id="logoutConfirmModal" class="modal">
        <div class="modal-content" style="max-width: 350px;">
            <span class="close-btn" onclick="closeLogoutConfirmModal()">√ó</span>
            <h2> X√°c Nh·∫≠n ƒêƒÉng Xu·∫•t </h2>
            <p style="text-align: center; margin-top: 15px;"> B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën ƒëƒÉng xu·∫•t kh·ªèi t√†i kho·∫£n n√†y? </p>
            <div class="action-buttons">
                <button type="button" class="cancel-btn" onclick="closeLogoutConfirmModal()"> H·ªßy </button>
                <button type="button" style="background-color: #e74c3c;" onclick="confirmLogout()"> ƒêƒÉng Xu·∫•t </button>
            </div>
        </div>
    </div>

    <div id="productModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-btn" onclick="closeProductModal()">√ó</span>
            <h2 id="productModalTitle"> Th√™m S·∫£n Ph·∫©m M·ªõi </h2>
            <form id="productForm" onsubmit="return handleSaveProduct(event)">
                <input type="hidden" id="productIdHidden">

                <label for="productName"><b> T√™n S·∫£n Ph·∫©m </b></label>
                <input type="text" id="productName" required placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m">

                <label for="productPrice"><b> Gi√° (VNƒê) </b></label>
                <input type="number" id="productPrice" required min="1000" placeholder="Nh·∫≠p gi√° s·∫£n ph·∫©m">

                <label for="productCategory"><b> Danh M·ª•c Ch√≠nh </b></label>
                <select id="productCategory" required onchange="renderProductSubCategories(this.value)">
                    <option value="">-- Ch·ªçn Danh M·ª•c --</option>
                    <option value="motorbike">Xe M√°y</option>
                    <option value="car">Xe √î T√¥</option>
                    <option value="oil">Nh·ªõt</option>
                    <option value="part">Ph·ª• T√πng Xe M√°y</option>
                </select>

                <label for="productSubCategory"><b> Danh M·ª•c Ph·ª• </b></label>
                <select id="productSubCategory" required>
                    <option value="">-- Ch·ªçn Danh M·ª•c Ph·ª• --</option>
                </select>

                <label for="productImg"><b> URL H√¨nh ·∫¢nh </b></label>
                <input type="text" id="productImg" required placeholder="D√°n URL h√¨nh ·∫£nh s·∫£n ph·∫©m">

                <div class="action-buttons">
                    <button type="button" class="cancel-btn" onclick="closeProductModal()"> H·ªßy </button>
                    <button type="submit" id="productModalSaveBtn"> L∆∞u S·∫£n Ph·∫©m </button>
                </div>
            </form>
        </div>
    </div>

    <div id="userDetailModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-btn" onclick="document.getElementById('userDetailModal').style.display='none'">√ó</span>
            <h2 style="text-align: left;"><i class="fas fa-user-circle"></i> Th√¥ng Tin Chi Ti·∫øt Kh√°ch H√†ng</h2>
            <hr style="margin-bottom: 20px; border-color: #f0f0f0;">
            <div id="userDetailContent">
                <img id="userAvatarModal" class="settings-avatar" src="" alt="Avatar">
                
                <p style="margin-top: 15px;"><label><b>T√™n ƒë·∫ßy ƒë·ªß:</b></label> <span id="userNameDetail"></span></p>
                <p><label><b>T√™n ƒëƒÉng nh·∫≠p:</b></label> <span id="userUsernameDetail"></span></p>
                <p><label><b>Email:</b></label> <span id="userEmailDetail"></span></p>
                <p><label><b>S·ªë ƒëi·ªán tho·∫°i:</b></label> <span id="userPhoneDetail"></span></p>
                
                <p style="margin-top: 20px; color: #e74c3c; font-size: 0.9em;"><em>* M·∫≠t kh·∫©u kh√¥ng ƒë∆∞·ª£c hi·ªÉn th·ªã v√¨ l√Ω do b·∫£o m·∫≠t.</em></p>
                
                <button type="button" style="background-color: #95a5a6; margin-top: 20px;" onclick="document.getElementById('userDetailModal').style.display='none'">
                    ƒê√≥ng
                </button>
            </div>
        </div>
    </div>
    <script>
        // --- 1. BI·∫æN GLOBAL V√Ä D·ªÆ LI·ªÜU M·∫™U ---

        let isLoggedIn = false;
        let currentUser = null;
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const mainSections = document.querySelectorAll('.main-section');
        const categoryItems = document.querySelectorAll('.category-item');
        const authLinks = document.getElementById('authLinks');
        const userProfileArea = document.getElementById('userProfileArea');
        const welcomeUserText = document.getElementById('welcomeUserText');
        const headerBottom = document.querySelector('.header-bottom');
        const categoryBar = document.querySelector('.category-bar');
        const headerCartIcon = document.getElementById('header-cart-icon');

        // Modals
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const profileModal = document.getElementById('profileModal');
        const logoutConfirmModal = document.getElementById('logoutConfirmModal');

        // Sub-modals
        const changeUsernameModal = document.getElementById('changeUsernameModal');
        const changeNameModal = document.getElementById('changeNameModal');
        const changeEmailModal = document.getElementById('changeEmailModal');
        const changePhoneModal = document.getElementById('changePhoneModal');
        const changePasswordModal = document.getElementById('changePasswordModal');
        const changeAvatarModal = document.getElementById('changeAvatarModal');


        const productData = JSON.parse(localStorage.getItem('productData')) || [
            { id: 1, name: 'Xe M√°y Honda Wave Alpha', price: 18000000, img: 'https://via.placeholder.com/250x200/3498db/FFFFFF?text=Wave+Alpha', category: 'motorbike', subCategory: 'xe_so' },
            { id: 2, name: 'Xe M√°y Vespa Sprint', price: 75000000, img: 'https://via.placeholder.com/250x200/e67e22/FFFFFF?text=Vespa+Sprint', category: 'motorbike', subCategory: 'xe_ga' },
            { id: 3, name: 'Nh·ªõt Castrol Power 1L', price: 100000, img: 'https://via.placeholder.com/250x200/2ecc71/FFFFFF?text=Castrol+Oil', category: 'oil', subCategory: 'nhot_ban_tong_hop' },
            { id: 4, name: 'L·ªçc Nh·ªõt Ch√≠nh H√£ng', price: 80000, img: 'https://via.placeholder.com/250x200/9b59b6/FFFFFF?text=Oil+Filter', category: 'part', subCategory: 'phu_tung_may' },
            { id: 5, name: 'Xe √î T√¥ Mazda 3 2025', price: 750000000, img: 'https://via.placeholder.com/250x200/e67e22/FFFFFF?text=Mazda+3', category: 'car', subCategory: 'sedan' },
            { id: 6, name: 'Ph·ª• T√πng L·ªçc Gi√≥ Xe M√°y', price: 50000, img: 'https://via.placeholder.com/250x200/34495e/FFFFFF?text=Air+Filter', category: 'part', subCategory: 'phu_tung_khac' },
            { id: 7, name: 'Xe M√°y Yamaha Exciter 155', price: 50000000, img: 'https://via.placeholder.com/250x200/f39c12/FFFFFF?text=Exciter', category: 'motorbike', subCategory: 'xe_con' },
            { id: 8, name: 'Nh·ªõt Shell Advance 1L', price: 120000, img: 'https://via.placeholder.com/250x200/7f8c8d/FFFFFF?text=Shell+Oil', category: 'oil', subCategory: 'nhot_tong_hop' },
            { id: 9, name: 'Xe √î T√¥ Toyota Fortuner', price: 1000000000, img: 'https://via.placeholder.com/250x200/2980b9/FFFFFF?text=Fortuner', category: 'car', subCategory: 'suv' },
            { id: 10, name: 'ƒê√®n Pha LED Xe M√°y', price: 350000, img: 'https://via.placeholder.com/250x200/c0392b/FFFFFF?text=Headlight', category: 'part', subCategory: 'phu_tung_khac' },
        ];

        // Danh m·ª•c ph·ª•
        const categoryMap = {
            'all': [], // Kh√¥ng c√≥ sub category khi ch·ªçn All
            'motorbike': [
                { id: 'xe_so', name: 'Xe S·ªë' },
                { id: 'xe_ga', name: 'Xe Ga' },
                { id: 'xe_con', name: 'Xe C√¥n Tay' },
                { id: 'all', name: 'T·∫•t C·∫£ Xe M√°y' }
            ],
            'car': [
                { id: 'sedan', name: 'Sedan' },
                { id: 'suv', name: 'SUV/Crossover' },
                { id: 'all', name: 'T·∫•t C·∫£ √î T√¥' }
            ],
            'oil': [
                { id: 'nhot_tong_hop', name: 'T·ªïng H·ª£p' },
                { id: 'nhot_ban_tong_hop', name: 'B√°n T·ªïng H·ª£p' },
                { id: 'all', name: 'T·∫•t C·∫£ Nh·ªõt' }
            ],
            'part': [
                { id: 'phu_tung_may', name: 'Ph·ª• T√πng M√°y' },
                { id: 'phu_tung_khac', name: 'Ph·ª• T√πng Kh√°c' },
                { id: 'all', name: 'T·∫•t C·∫£ Ph·ª• T√πng' }
            ]
        };

        const orderStatusMap = [
            { id: 'pending', text: 'Ch·ªù x√°c nh·∫≠n' },
            { id: 'confirmed', text: 'ƒê√£ x√°c nh·∫≠n' },
            { id: 'ready_to_ship', text: 'ƒêang ƒë√≥ng g√≥i' },
            { id: 'shipping', text: 'ƒêang giao h√†ng' },
            { id: 'delivered', text: 'ƒê√£ giao h√†ng' },
            { id: 'cancelled', text: 'ƒê√£ h·ªßy' },
        ];

        let sampleOrders = JSON.parse(localStorage.getItem('sampleOrders')) || [
            { id: 1, date: '01/12/2025', total: 100030000, items: [{ name: 'Xe M√°y Honda Wave Alpha', price: 18000000, quantity: 1 }, { name: 'Xe √î T√¥ Mazda 3 2025', price: 750000000, quantity: 1 }], status: 'delivered', statusText: 'ƒê√£ giao h√†ng', recipient: 'Nguy·ªÖn VƒÉn A', address: '123 ƒê∆∞·ªùng ABC, H√† N·ªôi', phone: '0987654321', paymentMethod: 'COD', userId: 'user1' },
            { id: 2, date: '05/12/2025', total: 130000, items: [{ name: 'Nh·ªõt Castrol Power 1L', price: 100000, quantity: 1 }], status: 'pending', statusText: 'Ch·ªù x√°c nh·∫≠n', recipient: 'Tr·∫ßn Th·ªã B', address: '456 ƒê∆∞·ªùng XYZ, ƒê√† N·∫µng', phone: '0901234567', paymentMethod: 'Bank', userId: 'user2' },
        ];


        // --- 2. H√ÄM CHUNG & HI·ªÇN TH·ªä UI ---

        /**
         * Hi·ªÉn th·ªã Toast Notification
         * @param {string} message - N·ªôi dung th√¥ng b√°o
         * @param {('success'|'warning'|'error')} type - Lo·∫°i th√¥ng b√°o
         */
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            if (!container) return;

            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;

            container.appendChild(toast);

            // Trigger reflow to start the transition
            requestAnimationFrame(() => {
                toast.classList.add('show');
            });

            // T·ª± ƒë·ªông x√≥a sau 3 gi√¢y
            setTimeout(() => {
                toast.classList.remove('show');
                // Ch·ªù transition k·∫øt th√∫c r·ªìi m·ªõi x√≥a element
                toast.addEventListener('transitionend', () => {
                    if (!container.contains(toast)) return; // Check if it hasn't been removed already
                    container.removeChild(toast);
                });
            }, 3000);
        }

        /**
         * ƒê·ªãnh d·∫°ng s·ªë th√†nh ti·ªÅn t·ªá Vi·ªát Nam (VNƒê)
         * @param {number} amount - S·ªë ti·ªÅn
         * @returns {string} - Chu·ªói ti·ªÅn t·ªá
         */
        function formatCurrency(amount) {
            if (typeof amount !== 'number') return '0 VNƒê';
            return amount.toLocaleString('vi-VN', { style: 'currency', currency: 'VND' });
        }

        /**
         * Toggle hi·ªÉn th·ªã m·∫≠t kh·∫©u
         * @param {string} inputId - ID c·ªßa input m·∫≠t kh·∫©u
         * @param {HTMLElement} iconElement - Element c·ªßa icon
         */
        function togglePassword(inputId, iconElement) {
            const input = document.getElementById(inputId);
            const icon = iconElement.querySelector('i');
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = "password";
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        /**
         * H√†m chuy·ªÉn ƒë·ªïi n·ªôi dung hi·ªÉn th·ªã ch√≠nh v√† c·∫≠p nh·∫≠t thanh ƒëi·ªÅu h∆∞·ªõng
         * @param {string} sectionId - ID c·ªßa section mu·ªën hi·ªÉn th·ªã
         * @param {HTMLElement} element - Ph·∫ßn t·ª≠ nav/category ƒë∆∞·ª£c click
         */
        function showContent(sectionId, element) {
            // ·∫®n t·∫•t c·∫£ c√°c section ch√≠nh
            mainSections.forEach(section => {
                section.classList.remove('active');
            });

            // X√≥a tr·∫°ng th√°i active tr√™n thanh ƒëi·ªÅu h∆∞·ªõng
            categoryItems.forEach(item => {
                item.classList.remove('active');
            });
            headerCartIcon.classList.remove('active-cart');

            // X·ª≠ l√Ω Admin Dashboard
            if (currentUser && currentUser.isAdmin) {
                if (sectionId === 'admin-dashboard-section') {
                    document.getElementById(sectionId).classList.add('active');
                    // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã Qu·∫£n l√Ω ƒê∆°n h√†ng
                    const defaultAdminBtn = document.querySelector('.admin-nav-btn[data-target="admin-orders"]');
                    if (defaultAdminBtn) {
                        showAdminContent('admin-orders', defaultAdminBtn);
                    }
                }
                return; // Admin kh√¥ng th·∫•y c√°c section kh√°c
            }

            // Hi·ªÉn th·ªã section mong mu·ªën cho ng∆∞·ªùi d√πng th∆∞·ªùng
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            if (element) {
                element.classList.add('active');
            }

            // X·ª≠ l√Ω hi·ªÉn th·ªã slider
            const sliderContainer = document.querySelector('.slider-container');
            if (sectionId === 'home-section') {
                sliderContainer.style.display = 'block';
            } else {
                sliderContainer.style.display = 'none';
            }

            // X·ª≠ l√Ω hi·ªÉn th·ªã gi·ªè h√†ng
            if (sectionId === 'cart-section') {
                headerCartIcon.classList.add('active-cart');
                renderCart(); // G·ªçi h√†m render gi·ªè h√†ng khi chuy·ªÉn ƒë·∫øn trang gi·ªè h√†ng
            }

            // X·ª≠ l√Ω hi·ªÉn th·ªã trang s·∫£n ph·∫©m (m·∫∑c ƒë·ªãnh)
            if (sectionId === 'products-section') {
                // ƒê·∫£m b·∫£o n√∫t "T·∫•t C·∫£" ƒë∆∞·ª£c ch·ªçn v√† hi·ªÉn th·ªã s·∫£n ph·∫©m m·∫∑c ƒë·ªãnh
                const defaultBtn = document.querySelector('.products-category-filter .category-btn[data-category="all"]');
                if (defaultBtn && !defaultBtn.classList.contains('active')) {
                    filterProducts('all', 'all', defaultBtn);
                } else if (defaultBtn && defaultBtn.classList.contains('active')) {
                    // N·∫øu ƒë√£ active r·ªìi, ch·ªâ c·∫ßn render l·∫°i s·∫£n ph·∫©m theo filter hi·ªán t·∫°i
                    const currentMainCategory = defaultBtn.getAttribute('data-category');
                    const currentSubCategoryBtn = document.querySelector('.products-sub-category-filter .subcategory-btn.active');
                    const currentSubCategory = currentSubCategoryBtn ? currentSubCategoryBtn.getAttribute('data-subcategory') : 'all';
                    renderProducts(currentMainCategory, currentSubCategory);
                }
            }

            // X·ª≠ l√Ω hi·ªÉn th·ªã trang ƒë∆°n h√†ng
            if (sectionId === 'orders-section') {
                if (!currentUser) {
                    showToast("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ xem ƒë∆°n h√†ng.", 'warning');
                    showContent('home-section', document.getElementById('nav-home'));
                    return;
                }
                // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã tr·∫°ng th√°i "All"
                const defaultStatusBtn = document.querySelector('#userOrderStatusFilter .status-btn[data-status="all"]');
                if (defaultStatusBtn) {
                    filterOrders('all', defaultStatusBtn);
                }
            }
        }


        // --- 3. SLIDER LOGIC ---

        let currentSlide = 0;
        const slides = document.getElementById('imageSlider');
        const totalSlides = 3;

        function moveSlider(direction) {
            currentSlide = (currentSlide + direction + totalSlides) % totalSlides;
            slides.style.transform = `translateX(${-currentSlide * 100}%)`;
        }

        // T·ª± ƒë·ªông chuy·ªÉn slide sau 5 gi√¢y
        setInterval(() => {
            moveSlider(1);
        }, 5000);


        // --- 4. LOGIN & REGISTER & PROFILE LOGIC ---

        function openLoginModal() {
            loginModal.style.display = "flex";
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginMessage').textContent = '';
        }

        function closeLoginModal() {
            loginModal.style.display = "none";
        }

        function openRegisterModal() {
            registerModal.style.display = "flex";
            document.getElementById('registerForm').reset();
            document.getElementById('registerMessage').textContent = '';
        }

        function closeRegisterModal() {
            registerModal.style.display = "none";
        }

        function openProfileModal() {
            if (!currentUser) return;

            // Update UI with current user info
            document.getElementById('displayNameSettings').textContent = currentUser.name;
            document.getElementById('currentUsername').textContent = currentUser.username;
            document.getElementById('currentName').textContent = currentUser.name;
            document.getElementById('currentEmail').textContent = currentUser.email;
            document.getElementById('currentPhone').textContent = currentUser.phone;
            document.getElementById('displayNameSettings').src = currentUser.avatar;

            const adminBadge = document.getElementById('isAdminBadge');
            if (currentUser.isAdmin) {
                adminBadge.style.display = 'inline-block';
            } else {
                adminBadge.style.display = 'none';
            }

            profileModal.style.display = "flex";
        }

        function closeProfileModal() {
            profileModal.style.display = "none";
        }

        function openLogoutConfirmModal() {
            logoutConfirmModal.style.display = "flex";
        }

        function closeLogoutConfirmModal() {
            logoutConfirmModal.style.display = "none";
        }

        function switchToRegister() {
            closeLoginModal();
            openRegisterModal();
        }

        function switchToLogin() {
            closeRegisterModal();
            openLoginModal();
        }

        function handleRegister(event) {
            event.preventDefault();
            const form = event.target;
            const name = form.elements['reg_name'].value.trim();
            const phone = form.elements['reg_phone'].value.trim();
            const email = form.elements['reg_email'].value.trim();
            const username = form.elements['reg_username'].value.trim();
            const password = form.elements['reg_password'].value;
            const messageElement = document.getElementById('registerMessage');
            messageElement.textContent = '';

            if (localStorage.getItem('user_' + username)) {
                messageElement.textContent = 'L·ªói: T√™n ƒëƒÉng nh·∫≠p n√†y ƒë√£ t·ªìn t·∫°i.';
                return false;
            }

            let emailExists = false;
            let phoneExists = false;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('user_')) {
                    const user = JSON.parse(localStorage.getItem(key));
                    if (user.email === email) {
                        emailExists = true;
                    }
                    if (user.phone === phone) {
                        phoneExists = true;
                    }
                }
            }

            if (emailExists) {
                showToast("L·ªói: Email n√†y ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω cho m·ªôt t√†i kho·∫£n kh√°c.", 'error');
                return false;
            }
            if (phoneExists) {
                showToast("L·ªói: S·ªë ƒëi·ªán tho·∫°i n√†y ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω cho m·ªôt t√†i kho·∫£n kh√°c.", 'error');
                return false;
            }

            const newUser = {
                name: name,
                phone: phone,
                email: email,
                username: username,
                password: password,
                avatar: 'https://via.placeholder.com/100/CCCCCC/808080?text=USER',
                isAdmin: false
            };

            localStorage.setItem('user_' + username, JSON.stringify(newUser));

            showToast(`ƒêƒÉng k√Ω th√†nh c√¥ng cho t√†i kho·∫£n ${username}! Vui l√≤ng ƒëƒÉng nh·∫≠p.`, 'success');
            closeRegisterModal();
            openLoginModal();

            return false;
        }

        function handleLogin(event) {
            event.preventDefault();
            const ADMIN_USER = 'admin';
            const ADMIN_PASS = 'admin123';
            const usernameInput = document.getElementById('loginUsername').value.trim();
            const passwordInput = document.getElementById('loginPassword').value;
            const messageElement = document.getElementById('loginMessage');
            messageElement.textContent = 'ƒêang ki·ªÉm tra...';
            messageElement.style.color = '#f77f00';

            // 1. Ki·ªÉm tra Admin
            if (usernameInput === ADMIN_USER && passwordInput === ADMIN_PASS) {
                currentUser = {
                    name: "Admin",
                    email: "admin@shop.com",
                    username: ADMIN_USER,
                    isAdmin: true,
                    avatar: 'https://via.placeholder.com/100/F77F00/FFFFFF?text=ADMIN'
                };
            } else {
                // 2. Ki·ªÉm tra t√†i kho·∫£n User
                let storedUserString = localStorage.getItem('user_' + usernameInput);

                // N·∫øu kh√¥ng t√¨m th·∫•y b·∫±ng username, t√¨m b·∫±ng email
                if (!storedUserString) {
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith('user_')) {
                            const user = JSON.parse(localStorage.getItem(key));
                            if (user.email === usernameInput) {
                                storedUserString = localStorage.getItem(key);
                                break;
                            }
                        }
                    }
                }

                if (storedUserString) {
                    const storedUser = JSON.parse(storedUserString);
                    if (storedUser.password === passwordInput) {
                        currentUser = storedUser;
                    }
                }
            }

            if (currentUser) {
                isLoggedIn = true;
                localStorage.setItem('lastLoggedInUser', currentUser.username);
                messageElement.textContent = 'ƒêƒÉng nh·∫≠p th√†nh c√¥ng!';
                messageElement.style.color = 'green';
                setTimeout(() => {
                    closeLoginModal();
                    updateHeaderStatus();
                    showToast(`Ch√†o m·ª´ng tr·ªü l·∫°i, ${currentUser.name}!`, 'success');
                }, 1000);
            } else {
                messageElement.textContent = 'T√™n ƒëƒÉng nh·∫≠p, Email ho·∫∑c M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng.';
                messageElement.style.color = 'red';
            }

            return false;
        }

        function handleLogout() {
            openLogoutConfirmModal();
        }

        function confirmLogout() {
            // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p Admin Logout
            if (currentUser && currentUser.isAdmin) {
                headerBottom.style.display = 'flex';
                categoryBar.style.display = 'flex';
                document.body.style.backgroundColor = '#f0f0f0';
            }

            isLoggedIn = false;
            currentUser = null;
            localStorage.removeItem('lastLoggedInUser');
            updateHeaderStatus();
            closeLogoutConfirmModal();
            showContent('home-section', document.getElementById('nav-home')); // Quay v·ªÅ trang ch·ªß
            showToast("ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng.", 'warning');
        }

        function updateHeaderStatus() {
            // ·∫®n t·∫•t c·∫£ c√°c section khi b·∫Øt ƒë·∫ßu c·∫≠p nh·∫≠t tr·∫°ng th√°i
            mainSections.forEach(section => section.classList.remove('active'));

            if (isLoggedIn && currentUser) {
                authLinks.style.display = 'none';
                userProfileArea.style.display = 'flex';
                welcomeUserText.textContent = `Xin ch√†o, ${currentUser.name}`;
                document.querySelector('.profile-avatar i').style.color = currentUser.isAdmin ? 'yellow' : 'white';

                if (currentUser.isAdmin) {
                    // Hi·ªÉn th·ªã Admin dashboard v√† ·∫©n c√°c m·ª•c user
                    headerBottom.style.display = 'none';
                    categoryBar.style.display = 'none';
                    document.body.style.backgroundColor = '#e9ecef';
                    const sliderContainer = document.querySelector('.slider-container');
                    if (sliderContainer) sliderContainer.style.display = 'none';
                    showContent('admin-dashboard-section', null);
                } else {
                    // Hi·ªÉn th·ªã giao di·ªán user b√¨nh th∆∞·ªùng
                    headerBottom.style.display = 'flex';
                    categoryBar.style.display = 'flex';
                    document.body.style.backgroundColor = '#f0f0f0';
                    showContent('home-section', document.getElementById('nav-home'));
                }

            } else {
                authLinks.style.display = 'inline';
                userProfileArea.style.display = 'none';
                headerBottom.style.display = 'flex';
                categoryBar.style.display = 'flex';
                document.body.style.backgroundColor = '#f0f0f0';
            }
        }

        // --- Profile Update Sub-Modals ---

        function openChangeUsernameModal() {
            document.getElementById('inputNewUsername').value = currentUser.username;
            document.getElementById('inputConfirmPasswordUsername').value = '';
            document.getElementById('usernameMessage').textContent = '';
            closeProfileModal();
            changeUsernameModal.style.display = "flex";
        }

        function closeChangeUsernameModal() {
            changeUsernameModal.style.display = "none";
            openProfileModal();
        }

        function handleUpdateUsername(event) {
            event.preventDefault();
            const newUsername = document.getElementById('inputNewUsername').value.trim();
            const confirmedPassword = document.getElementById('inputConfirmPasswordUsername').value;
            const messageElement = document.getElementById('usernameMessage');
            messageElement.textContent = '';

            if (newUsername === currentUser.username) {
                messageElement.textContent = 'T√™n ƒëƒÉng nh·∫≠p m·ªõi ph·∫£i kh√°c t√™n ƒëƒÉng nh·∫≠p hi·ªán t·∫°i.';
                return false;
            }
            if (confirmedPassword !== currentUser.password) {
                messageElement.textContent = 'M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng ƒë√∫ng.';
                return false;
            }
            if (localStorage.getItem('user_' + newUsername)) {
                messageElement.textContent = 'T√™n ƒëƒÉng nh·∫≠p n√†y ƒë√£ c√≥ ng∆∞·ªùi s·ª≠ d·ª•ng.';
                return false;
            }

            // X√≥a user c≈© v√† l∆∞u user m·ªõi
            localStorage.removeItem('user_' + currentUser.username);
            currentUser.username = newUsername;
            localStorage.setItem('user_' + currentUser.username, JSON.stringify(currentUser));
            localStorage.setItem('lastLoggedInUser', currentUser.username);

            document.getElementById('welcomeUserText').textContent = `Xin ch√†o, ${currentUser.name}`;
            document.getElementById('currentUsername').textContent = newUsername;
            closeChangeUsernameModal();
            showToast("ƒê√£ c·∫≠p nh·∫≠t t√™n ƒëƒÉng nh·∫≠p th√†nh c√¥ng!", 'success');
            return false;
        }

        function openChangeNameModal() {
            document.getElementById('inputNewName').value = currentUser.name;
            document.getElementById('inputConfirmPasswordName').value = '';
            closeProfileModal();
            changeNameModal.style.display = "flex";
        }

        function closeChangeNameModal() {
            changeNameModal.style.display = "none";
            openProfileModal();
        }

        function handleUpdateName(event) {
            event.preventDefault();
            const newName = document.getElementById('inputNewName').value.trim();
            const confirmedPassword = document.getElementById('inputConfirmPasswordName').value;

            if (newName === currentUser.name) {
                showToast("T√™n hi·ªÉn th·ªã m·ªõi ph·∫£i kh√°c t√™n hi·ªán t·∫°i.", 'warning');
                return false;
            }
            if (confirmedPassword !== currentUser.password) {
                showToast("M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng ƒë√∫ng.", 'error');
                return false;
            }

            currentUser.name = newName;
            localStorage.setItem('user_' + currentUser.username, JSON.stringify(currentUser));

            document.getElementById('welcomeUserText').textContent = `Xin ch√†o, ${currentUser.name}`;
            document.getElementById('displayNameSettings').textContent = newName;
            document.getElementById('currentName').textContent = newName;
            closeChangeNameModal();
            showToast("ƒê√£ c·∫≠p nh·∫≠t t√™n hi·ªÉn th·ªã th√†nh c√¥ng!", 'success');
            return false;
        }

        function openChangeEmailModal() {
            document.getElementById('inputNewEmail').value = currentUser.email;
            document.getElementById('inputConfirmPasswordEmail').value = '';
            document.getElementById('emailMessage').textContent = '';
            closeProfileModal();
            changeEmailModal.style.display = "flex";
        }

        function closeChangeEmailModal() {
            changeEmailModal.style.display = "none";
            openProfileModal();
        }

        function handleUpdateEmail(event) {
            event.preventDefault();
            const newEmail = document.getElementById('inputNewEmail').value.trim();
            const confirmedPassword = document.getElementById('inputConfirmPasswordEmail').value;
            const messageElement = document.getElementById('emailMessage');
            messageElement.textContent = '';

            if (newEmail === currentUser.email) {
                messageElement.textContent = 'Email m·ªõi ph·∫£i kh√°c email hi·ªán t·∫°i.';
                return false;
            }
            if (confirmedPassword !== currentUser.password) {
                messageElement.textContent = 'M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng ƒë√∫ng.';
                return false;
            }

            let emailExists = false;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('user_')) {
                    const user = JSON.parse(localStorage.getItem(key));
                    if (user.email === newEmail && user.username !== currentUser.username) {
                        emailExists = true;
                        break;
                    }
                }
            }

            if (emailExists) {
                messageElement.textContent = 'Email n√†y ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω cho m·ªôt t√†i kho·∫£n kh√°c.';
                return false;
            }

            currentUser.email = newEmail;
            localStorage.setItem('user_' + currentUser.username, JSON.stringify(currentUser));

            document.getElementById('currentEmail').textContent = newEmail;
            closeChangeEmailModal();
            showToast("ƒê√£ c·∫≠p nh·∫≠t Email th√†nh c√¥ng!", 'success');
            return false;
        }

        function openChangePhoneModal() {
            document.getElementById('inputCurrentPhone').value = currentUser.phone;
            document.getElementById('inputNewPhone').value = '';
            document.getElementById('inputConfirmPasswordPhone').value = '';
            document.getElementById('phoneMessage').textContent = '';
            closeProfileModal();
            changePhoneModal.style.display = "flex";
        }

        function closeChangePhoneModal() {
            changePhoneModal.style.display = "none";
            openProfileModal();
        }

        function handleUpdatePhone(event) {
            event.preventDefault();
            const newPhone = document.getElementById('inputNewPhone').value.trim();
            const confirmedPassword = document.getElementById('inputConfirmPasswordPhone').value;
            const messageElement = document.getElementById('phoneMessage');
            messageElement.textContent = '';

            if (newPhone === currentUser.phone) {
                messageElement.textContent = 'S·ªë ƒëi·ªán tho·∫°i m·ªõi ph·∫£i kh√°c s·ªë hi·ªán t·∫°i.';
                return false;
            }
            if (confirmedPassword !== currentUser.password) {
                messageElement.textContent = 'M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng ƒë√∫ng.';
                return false;
            }

            let phoneExists = false;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('user_')) {
                    const user = JSON.parse(localStorage.getItem(key));
                    if (user.phone === newPhone && user.username !== currentUser.username) {
                        phoneExists = true;
                        break;
                    }
                }
            }

            if (phoneExists) {
                messageElement.textContent = 'S·ªë ƒëi·ªán tho·∫°i n√†y ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω cho m·ªôt t√†i kho·∫£n kh√°c.';
                return false;
            }

            currentUser.phone = newPhone;
            localStorage.setItem('user_' + currentUser.username, JSON.stringify(currentUser));

            document.getElementById('currentPhone').textContent = newPhone;
            closeChangePhoneModal();
            showToast("ƒê√£ c·∫≠p nh·∫≠t S·ªë ƒëi·ªán tho·∫°i th√†nh c√¥ng!", 'success');
            return false;
        }

        function openChangePasswordModal() {
            document.getElementById('inputCurrentPassword').value = '';
            document.getElementById('inputNewPassword').value = '';
            document.getElementById('inputConfirmNewPassword').value = '';
            document.getElementById('passwordMessage').textContent = '';
            closeProfileModal();
            changePasswordModal.style.display = "flex";
        }

        function closeChangePasswordModal() {
            changePasswordModal.style.display = "none";
            openProfileModal();
        }

        function handleUpdatePassword(event) {
            event.preventDefault();
            const currentPassword = document.getElementById('inputCurrentPassword').value;
            const newPassword = document.getElementById('inputNewPassword').value;
            const confirmNewPassword = document.getElementById('inputConfirmNewPassword').value;
            const messageElement = document.getElementById('passwordMessage');
            messageElement.textContent = '';

            if (currentPassword !== currentUser.password) {
                messageElement.textContent = 'M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng.';
                return false;
            }
            if (newPassword !== confirmNewPassword) {
                messageElement.textContent = 'M·∫≠t kh·∫©u m·ªõi v√† x√°c nh·∫≠n m·∫≠t kh·∫©u kh√¥ng kh·ªõp.';
                return false;
            }
            if (newPassword === currentPassword) {
                messageElement.textContent = 'M·∫≠t kh·∫©u m·ªõi ph·∫£i kh√°c m·∫≠t kh·∫©u hi·ªán t·∫°i.';
                return false;
            }

            currentUser.password = newPassword;
            localStorage.setItem('user_' + currentUser.username, JSON.stringify(currentUser));

            closeChangePasswordModal();
            showToast("ƒê√£ c·∫≠p nh·∫≠t m·∫≠t kh·∫©u th√†nh c√¥ng! Vui l√≤ng nh·ªõ m·∫≠t kh·∫©u m·ªõi.", 'success');
            return false;
        }

        function openChangeAvatarModal() {
            document.getElementById('inputNewAvatarUrl').value = currentUser.avatar;
            document.getElementById('previewNewAvatar').src = currentUser.avatar;
            closeProfileModal();
            changeAvatarModal.style.display = "flex";
        }

        function closeChangeAvatarModal() {
            changeAvatarModal.style.display = "none";
            openProfileModal();
        }

        function handleUpdateAvatar(event) {
            event.preventDefault();
            const newAvatarUrl = document.getElementById('inputNewAvatarUrl').value.trim();

            currentUser.avatar = newAvatarUrl;
            localStorage.setItem('user_' + currentUser.username, JSON.stringify(currentUser));

            // Update avatar in profile modal
            document.getElementById('displayNameSettings').src = newAvatarUrl;
            // Update avatar icon in header (if it were an image, but it's an icon here, so nothing to update)

            closeChangeAvatarModal();
            showToast("ƒê√£ c·∫≠p nh·∫≠t ·∫¢nh ƒë·∫°i di·ªán th√†nh c√¥ng!", 'success');
            return false;
        }


        // --- 5. H√ÄM S·∫¢N PH·∫®M & T√åM KI·∫æM ---

        function renderProducts(mainCategory = 'all', subCategory = 'all', searchTerm = '') {
            const container = document.getElementById('productGrid');
            if (!container) return;

            let filteredProducts = productData;

            // 1. L·ªçc theo Danh m·ª•c ch√≠nh (Category)
            if (mainCategory !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.category === mainCategory);
            }

            // 2. L·ªçc theo Danh m·ª•c ph·ª• (Sub-Category)
            if (subCategory !== 'all') {
                filteredProducts = filteredProducts.filter(p => p.subCategory === subCategory);
            }

            // 3. L·ªçc theo T√¨m ki·∫øm (Search)
            if (searchTerm) {
                const lowerCaseSearch = searchTerm.toLowerCase();
                filteredProducts = filteredProducts.filter(p =>
                    p.name.toLowerCase().includes(lowerCaseSearch) ||
                    p.category.toLowerCase().includes(lowerCaseSearch) ||
                    p.subCategory.toLowerCase().includes(lowerCaseSearch)
                );
            }

            if (filteredProducts.length === 0) {
                container.innerHTML = '<p style="text-align: center; margin-top: 30px; font-size: 1.1em; color: #777;">Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o ph√π h·ª£p.</p>';
                return;
            }

            container.innerHTML = filteredProducts.map(product => `
                <div class="product-card">
                    <img src="${product.img}" alt="${product.name}">
                    <div class="product-info">
                        <h4>${product.name}</h4>
                        <div class="product-price">${formatCurrency(product.price)}</div>
                        <button class="add-to-cart-btn" onclick="addToCart(${product.id})">
                            <i class="fas fa-cart-plus"></i> Th√™m v√†o gi·ªè h√†ng
                        </button>
                    </div>
                </div>
            `).join('');
        }

        /**
         * Render c√°c n√∫t danh m·ª•c ch√≠nh (C·∫•p 1)
         */
        function renderMainCategories() {
            const mainFilterContainer = document.getElementById('productsCategoryFilter');
            if (!mainFilterContainer) return;

            // D·ªØ li·ªáu m·∫´u (c√≥ th·ªÉ l·∫•y t·ª´ categoryMap n·∫øu mu·ªën linh ho·∫°t h∆°n)
            const mainCategories = [
                { id: 'all', name: 'T·∫•t C·∫£ S·∫£n Ph·∫©m', icon: 'fas fa-grip-horizontal' },
                { id: 'motorbike', name: 'Xe M√°y', icon: 'fas fa-motorcycle' },
                { id: 'car', name: 'Xe √î T√¥', icon: 'fas fa-car' },
                { id: 'oil', name: 'Nh·ªõt', icon: 'fas fa-tint' },
                { id: 'part', name: 'Ph·ª• T√πng', icon: 'fas fa-wrench' },
            ];

            mainFilterContainer.innerHTML = mainCategories.map(cat => `
                <button class="category-btn ${cat.id === 'all' ? 'active' : ''}"
                        data-category="${cat.id}"
                        onclick="filterProducts('${cat.id}', 'all', this)">
                    <i class="${cat.icon}"></i> ${cat.name}
                </button>
            `).join('');

            // M·∫∑c ƒë·ªãnh render sub-categories c·ªßa 'all'
            renderSubCategories('all');
            renderProducts('all', 'all'); // Render s·∫£n ph·∫©m m·∫∑c ƒë·ªãnh
        }

        /**
         * Render c√°c n√∫t danh m·ª•c ph·ª• (C·∫•p 2)
         * @param {string} mainCategory - Danh m·ª•c ch√≠nh hi·ªán t·∫°i
         */
        function renderSubCategories(mainCategory) {
            const subFilterContainer = document.getElementById('productsSubCategoryFilter');
            if (!subFilterContainer) return;

            if (mainCategory === 'all' || !categoryMap[mainCategory] || categoryMap[mainCategory].length === 0) {
                subFilterContainer.innerHTML = ''; // ·∫®n sub filter n·∫øu l√† "T·∫•t C·∫£" ho·∫∑c kh√¥ng c√≥
                return;
            }

            let html = '';
            // Th√™m n√∫t "T·∫•t C·∫£" m·∫∑c ƒë·ªãnh cho danh m·ª•c ph·ª•
            html += `<button class="subcategory-btn active" data-subcategory="all" onclick="filterProducts('${mainCategory}', 'all', this)"> T·∫•t C·∫£ </button>`;

            // Th√™m c√°c n√∫t danh m·ª•c ph·ª• kh√°c
            categoryMap[mainCategory].forEach(sub => {
                if(sub.id !== 'all') { // Kh√¥ng th√™m n√∫t 'all' l·∫ßn n·ªØa
                    html += `<button class="subcategory-btn" data-subcategory="${sub.id}" onclick="filterProducts('${mainCategory}', '${sub.id}', this)">${sub.name}</button>`;
                }
            });
            subFilterContainer.innerHTML = html;
        }

        /**
         * H√†m x·ª≠ l√Ω khi click v√†o n√∫t filter (C·∫•p 1 ho·∫∑c C·∫•p 2)
         * @param {string} category - Danh m·ª•c ch√≠nh
         * @param {string} subCategory - Danh m·ª•c ph·ª•
         * @param {HTMLElement} buttonElement - N√∫t ƒë∆∞·ª£c click
         */
        function filterProducts(category, subCategory, buttonElement) {
            // X√≥a n·ªôi dung t√¨m ki·∫øm
            document.getElementById('searchInput').value = '';

            // X·ª≠ l√Ω n√∫t Category (C·∫•p 1)
            const isMainCategoryButton = buttonElement.closest('#productsCategoryFilter');
            if (isMainCategoryButton) {
                // Remove 'active' from all main category buttons
                document.querySelectorAll('#productsCategoryFilter .category-btn').forEach(btn => btn.classList.remove('active'));
                buttonElement.classList.add('active');

                // Re-render sub-categories based on the new main category
                renderSubCategories(category);

                // Set subCategory back to 'all' if a new main category is selected
                subCategory = 'all';
            } else {
                // X·ª≠ l√Ω n√∫t Sub-Category (C·∫•p 2)
                const mainCategoryBtn = document.querySelector('#productsCategoryFilter .category-btn.active');
                if (mainCategoryBtn) {
                    category = mainCategoryBtn.getAttribute('data-category');
                }
                document.querySelectorAll('#productsSubCategoryFilter .subcategory-btn').forEach(btn => btn.classList.remove('active'));
                buttonElement.classList.add('active');
            }

            // Render s·∫£n ph·∫©m cu·ªëi c√πng
            renderProducts(category, subCategory);
        }

        function handleSearch(event) {
            event.preventDefault();
            const searchTerm = document.getElementById('searchInput').value.trim();

            // X√≥a tr·∫°ng th√°i active c·ªßa t·∫•t c·∫£ c√°c n√∫t filter
            document.querySelectorAll('.products-category-filter .category-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.products-sub-category-filter .subcategory-btn').forEach(btn => btn.classList.remove('active'));

            // Set n√∫t "T·∫•t C·∫£" (C·∫•p 1) th√†nh active
            const defaultBtn = document.querySelector('.products-category-filter .category-btn[data-category="all"]');
            if (defaultBtn) {
                defaultBtn.classList.add('active');
            }

            // Re-render sub-categories (s·∫Ω tr·ªëng n·∫øu l√† 'all')
            renderSubCategories('all');

            // Hi·ªÉn th·ªã section s·∫£n ph·∫©m n·∫øu ch∆∞a ·ªü ƒë√≥
            showContent('products-section', document.getElementById('nav-products'));

            // Render s·∫£n ph·∫©m theo t·ª´ kh√≥a t√¨m ki·∫øm
            renderProducts('all', 'all', searchTerm);

            if (searchTerm) {
                showToast(`ƒê√£ t√¨m ki·∫øm v·ªõi t·ª´ kh√≥a: "${searchTerm}"`, 'warning');
            }

            return false;
        }

        // --- 6. H√ÄM GI·ªé H√ÄNG (CART) ---

        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartIcon();
        }

        function updateCartIcon() {
            const totalItems = cart.reduce((sum, item) => sum + (item.selected ? item.quantity : 0), 0);
            const iconElement = document.getElementById('header-cart-icon');
            if (totalItems > 0) {
                iconElement.classList.add('active-cart');
            } else {
                // N·∫øu gi·ªè h√†ng tr·ªëng ho·∫∑c kh√¥ng c√≥ item n√†o ƒë∆∞·ª£c ch·ªçn, ch·ªâ gi·ªØ m√†u cam m·∫∑c ƒë·ªãnh
                if (cart.length === 0) {
                    iconElement.classList.remove('active-cart');
                }
            }
        }

        function addToCart(productId) {
            if (!isLoggedIn || currentUser.isAdmin) {
                showToast('Vui l√≤ng ƒëƒÉng nh·∫≠p b·∫±ng t√†i kho·∫£n kh√°ch h√†ng ƒë·ªÉ mua s·∫Øm.', 'warning');
                openLoginModal();
                return;
            }

            const product = productData.find(p => p.id === productId);
            if (!product) return;

            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity += 1;
                existingItem.selected = true; // Select by default when quantity changes
                showToast(`ƒê√£ c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng c·ªßa "${product.name}" trong gi·ªè h√†ng.`, 'warning');
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    img: product.img,
                    quantity: 1,
                    selected: true // New items are selected by default
                });
                showToast(`ƒê√£ th√™m "${product.name}" v√†o gi·ªè h√†ng.`, 'success');
            }

            saveCart();

            // N·∫øu ƒëang ·ªü trang gi·ªè h√†ng, c·∫≠p nh·∫≠t l·∫°i
            if (document.getElementById('cart-section').classList.contains('active')) {
                renderCart();
            }
            // N·∫øu ƒëang ·ªü trang thanh to√°n, c·∫≠p nh·∫≠t l·∫°i
            if (document.getElementById('checkout-section').classList.contains('active')) {
                renderCheckoutSummary();
            }
        }

        function removeCartItem(productId) {
            cart = cart.filter(item => item.id !== productId);
            saveCart();
            renderCart();
            showToast('ƒê√£ x√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng.', 'error');
            // N·∫øu ƒëang ·ªü trang thanh to√°n, c·∫≠p nh·∫≠t l·∫°i
            if (document.getElementById('checkout-section').classList.contains('active')) {
                renderCheckoutSummary();
            }
        }

        function updateCartItem(productId, quantity) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                const newQuantity = parseInt(quantity);
                if (newQuantity > 0) {
                    item.quantity = newQuantity;
                    item.selected = true; // Select by default when quantity changes
                    saveCart();
                    renderCart();
                    // N·∫øu ƒëang ·ªü trang thanh to√°n, c·∫≠p nh·∫≠t l·∫°i
                    if (document.getElementById('checkout-section').classList.contains('active')) {
                        renderCheckoutSummary();
                    }
                } else {
                    removeCartItem(productId);
                }
            }
        }

        function toggleItemSelection(productId, isChecked) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.selected = isChecked;
                saveCart();
                renderCartSummary(); // C·∫≠p nh·∫≠t summary ngay l·∫≠p t·ª©c
                updateCheckAllStatus(); // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t "Ch·ªçn t·∫•t c·∫£"
            }
        }

        function toggleSelectAll(isChecked) {
            cart.forEach(item => {
                item.selected = isChecked;
            });
            saveCart();
            renderCart(); // Render l·∫°i ƒë·ªÉ c·∫≠p nh·∫≠t checkbox
        }

        function updateCheckAllStatus() {
            const checkAll = document.getElementById('checkAllCartItems');
            if (checkAll) {
                if (cart.length > 0 && cart.every(item => item.selected)) {
                    checkAll.checked = true;
                } else {
                    checkAll.checked = false;
                }
            }
        }


        function renderCartSummary() {
            const subtotal = cart.reduce((sum, item) => sum + (item.selected ? item.price * item.quantity : 0), 0);
            const totalItems = cart.reduce((sum, item) => sum + (item.selected ? item.quantity : 0), 0);
            const shipping = 30000;
            const grandTotal = subtotal + (totalItems > 0 ? shipping : 0);

            document.getElementById('subtotalSummary').textContent = formatCurrency(subtotal);
            document.getElementById('totalItemsSummary').textContent = totalItems;
            document.getElementById('grandTotalSummary').textContent = formatCurrency(grandTotal);

            // C·∫≠p nh·∫≠t tr·∫°ng th√°i n√∫t Checkout
            const checkoutBtn = document.querySelector('#cart-section .checkout-btn');
            if (checkoutBtn) {
                if (totalItems > 0) {
                    checkoutBtn.disabled = false;
                    checkoutBtn.style.opacity = '1';
                } else {
                    checkoutBtn.disabled = true;
                    checkoutBtn.style.opacity = '0.5';
                }
            }
            updateCartIcon(); // Update cart icon to reflect selected items
        }

        function showCart() {
            if (!isLoggedIn || currentUser.isAdmin) {
                showToast('Vui l√≤ng ƒëƒÉng nh·∫≠p b·∫±ng t√†i kho·∫£n kh√°ch h√†ng ƒë·ªÉ xem gi·ªè h√†ng.', 'warning');
                openLoginModal();
                return;
            }
            showContent('cart-section', document.getElementById('nav-products')); // Gi·ªØ active ·ªü Products v√¨ Cart kh√¥ng c√≥ nav item ri√™ng
        }

        function renderCart() {
            const container = document.getElementById('cartItemsContainer');
            const cartTable = document.getElementById('cartTable');
            const checkAll = document.getElementById('checkAllCartItems');

            // C·∫≠p nh·∫≠t tr·∫°ng th√°i checkAll tr∆∞·ªõc khi render
            updateCheckAllStatus();

            if (cart.length === 0) {
                cartTable.style.display = 'none';
                container.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px; font-size: 1.1em; color: #777;">Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng.</td></tr>';
                renderCartSummary(); // C·∫≠p nh·∫≠t summary v·ªÅ 0
                return;
            }

            cartTable.style.display = 'table';
            container.innerHTML = cart.map(item => {
                const itemTotal = item.price * item.quantity;
                return `
                    <tr>
                        <td><input type="checkbox" ${item.selected ? 'checked' : ''} onchange="toggleItemSelection(${item.id}, this.checked)"></td>
                        <td>
                            <div class="item-detail">
                                <img src="${item.img}" alt="${item.name}">
                                <span>${item.name}</span>
                            </div>
                        </td>
                        <td class="item-price">${formatCurrency(item.price)}</td>
                        <td>
                            <input type="number" value="${item.quantity}" min="1" onchange="updateCartItem(${item.id}, this.value)">
                        </td>
                        <td class="item-total">${formatCurrency(itemTotal)}</td>
                        <td>
                            <button class="remove-btn" onclick="removeCartItem(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            renderCartSummary();
        }

        // --- 7. H√ÄM X·ª¨ L√ù ƒê∆†N H√ÄNG (ORDER) & CHECKOUT ---

        function showCheckout() {
            const selectedCartItems = cart.filter(item => item.selected);
            if (selectedCartItems.length === 0) {
                showToast("Vui l√≤ng ch·ªçn s·∫£n ph·∫©m mu·ªën thanh to√°n.", 'warning');
                return;
            }

            // T·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin ng∆∞·ªùi d√πng hi·ªán t·∫°i
            document.getElementById('recipientName').value = currentUser.name;
            document.getElementById('recipientPhone').value = currentUser.phone;
            // Gi·∫£ s·ª≠ ƒë·ªãa ch·ªâ kh√¥ng c√≥ s·∫µn trong profile, ƒë·ªÉ tr·ªëng ho·∫∑c ƒëi·ªÅn th√¥ng tin m·∫∑c ƒë·ªãnh
            document.getElementById('shippingAddress').value = '';

            // Chuy·ªÉn sang trang thanh to√°n
            showContent('checkout-section', document.getElementById('nav-products')); // Gi·ªØ active ·ªü Products
            renderCheckoutSummary();
        }

        function renderCheckoutSummary() {
            const checkoutItemsContainer = document.getElementById('checkoutOrderItems');
            const subtotalCheckoutElement = document.getElementById('subtotalCheckout');
            const totalItemsCheckoutElement = document.getElementById('totalItemsCheckout');
            const shippingCheckoutElement = document.getElementById('shippingCheckout');
            const grandTotalCheckoutElement = document.getElementById('grandTotalCheckout');
            const checkoutBtn = document.querySelector('#checkout-section .checkout-btn');

            const selectedCartItems = cart.filter(item => item.selected);

            if (selectedCartItems.length === 0) {
                checkoutItemsContainer.innerHTML = '<p style="text-align: center; color: #999;"> Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o ƒë∆∞·ª£c ch·ªçn. </p>';
                subtotalCheckoutElement.textContent = '0 VNƒê';
                totalItemsCheckoutElement.textContent = '0';
                shippingCheckoutElement.textContent = '0 VNƒê';
                grandTotalCheckoutElement.textContent = '0 VNƒê';
                checkoutBtn.disabled = true;
                checkoutBtn.style.opacity = '0.5';
                return;
            }

            const subtotal = selectedCartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const totalItems = selectedCartItems.reduce((sum, item) => sum + item.quantity, 0);
            const shipping = 30000;
            const grandTotal = subtotal + shipping;

            checkoutItemsContainer.innerHTML = selectedCartItems.map(item => `
                <div class="checkout-item">
                    <span>${item.name} (x${item.quantity})</span>
                    <span>${formatCurrency(item.price * item.quantity)}</span>
                </div>
            `).join('');

            subtotalCheckoutElement.textContent = formatCurrency(subtotal);
            totalItemsCheckoutElement.textContent = totalItems;
            shippingCheckoutElement.textContent = formatCurrency(shipping);
            grandTotalCheckoutElement.textContent = formatCurrency(grandTotal);
            checkoutBtn.disabled = false;
            checkoutBtn.style.opacity = '1';
        }

        function placeOrder() {
            if (!currentUser) {
                showToast("Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒë·∫∑t h√†ng.", 'error');
                return;
            }

            const name = document.getElementById('recipientName').value.trim();
            const phone = document.getElementById('recipientPhone').value.trim();
            const address = document.getElementById('shippingAddress').value.trim();
            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;

            if (!name || !phone || !address) {
                showToast("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin v·∫≠n chuy·ªÉn.", 'warning');
                return;
            }

            const newOrderItems = cart.filter(item => item.selected).map(item => ({
                name: item.name,
                price: item.price,
                quantity: item.quantity
            }));

            if (newOrderItems.length === 0) {
                showToast("Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o ƒë∆∞·ª£c ch·ªçn ƒë·ªÉ ƒë·∫∑t h√†ng.", 'error');
                return;
            }

            const newOrderSubtotal = newOrderItems.reduce((sum, item) => sum + item.price * item.quantity, 0);
            const shippingFee = 30000;
            const newOrderTotal = newOrderSubtotal + shippingFee;

            // T·∫°o ID ƒë∆°n h√†ng m·ªõi
            const maxId = sampleOrders.length > 0 ? Math.max(...sampleOrders.map(o => o.id)) : 0;
            const orderId = maxId + 1;

            const today = new Date();
            const dateString = `${today.getDate().toString().padStart(2, '0')}/${(today.getMonth() + 1).toString().padStart(2, '0')}/${today.getFullYear()}`;

            const newOrder = {
                id: orderId,
                date: dateString,
                total: newOrderTotal,
                items: newOrderItems,
                status: 'pending',
                statusText: 'Ch·ªù x√°c nh·∫≠n',
                recipient: name,
                address: address,
                phone: phone,
                paymentMethod: paymentMethod,
                userId: currentUser.username // Th√™m userId ƒë·ªÉ qu·∫£n l√Ω ƒë∆°n h√†ng theo ng∆∞·ªùi d√πng
            };

            // Th√™m v√†o danh s√°ch ƒë∆°n h√†ng m·∫´u
            sampleOrders.unshift(newOrder);
            localStorage.setItem('sampleOrders', JSON.stringify(sampleOrders));

            // X√≥a c√°c s·∫£n ph·∫©m ƒë√£ ƒë·∫∑t kh·ªèi gi·ªè h√†ng
            cart = cart.filter(item => !item.selected);
            saveCart();

            // Chuy·ªÉn sang trang ƒê∆°n H√†ng
            showContent('orders-section', document.getElementById('nav-orders'));
            showToast("ƒê·∫∑t h√†ng th√†nh c√¥ng! M√£ ƒë∆°n h√†ng: #" + orderId.toString().padStart(6, '0'), 'success');

            // Reset form
            document.getElementById('shippingForm').reset();
            renderOrders('pending'); // Hi·ªÉn th·ªã ƒë∆°n h√†ng m·ªõi
        }

        /**
         * Render danh s√°ch ƒë∆°n h√†ng (User View)
         * @param {string} filterStatus - Tr·∫°ng th√°i c·∫ßn l·ªçc ('all', 'pending', ...)
         */
        function renderOrders(filterStatus = 'all') {
            const container = document.getElementById('orderListContainer');
            if (!container || !currentUser || currentUser.isAdmin) return; // Kh√¥ng ch·∫°y n·∫øu l√† Admin

            // 1. L·ªçc theo ng∆∞·ªùi d√πng (ch·ªâ hi·ªÉn th·ªã ƒë∆°n h√†ng c·ªßa ng∆∞·ªùi d√πng hi·ªán t·∫°i)
            let userFilteredOrders = sampleOrders.filter(order => order.userId === currentUser.username);

            // 2. L·ªçc theo tr·∫°ng th√°i
            let finalFilteredOrders = userFilteredOrders;
            if (filterStatus !== 'all') {
                finalFilteredOrders = userFilteredOrders.filter(order => order.status === filterStatus);
            }

            if (finalFilteredOrders.length === 0) {
                container.innerHTML = '<p style="text-align: center; margin-top: 30px; font-size: 1.1em; color: #777;">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o ·ªü tr·∫°ng th√°i n√†y.</p>';
                return;
            }

            container.innerHTML = finalFilteredOrders.map(order => {
                const statusInfo = orderStatusMap.find(s => s.id === order.status);
                const statusClass = `status-${order.status}`;
                const orderItemsHtml = order.items.map(item =>
                    `<li>${item.name} x ${item.quantity} (${formatCurrency(item.price)})</li>`
                ).join('');

                return `
                    <div class="order-item">
                        <div class="order-header">
                            <span class="order-id">ƒê∆°n h√†ng #${order.id.toString().padStart(6, '0')}</span>
                            <span class="order-status ${statusClass}">
                                <i class="fas fa-info-circle"></i> ${statusInfo ? statusInfo.text : order.statusText}
                            </span>
                        </div>
                        <div class="order-details">
                            <p><strong>Ng√†y ƒë·∫∑t:</strong> ${order.date}</p>
                            <p><strong>Ng∆∞·ªùi nh·∫≠n:</strong> ${order.recipient} - ${order.phone}</p>
                            <p><strong>ƒê·ªãa ch·ªâ:</strong> ${order.address}</p>
                            <p><strong>S·∫£n ph·∫©m:</strong></p>
                            <ul style="list-style: none; padding-left: 20px; font-size: 0.9em; color: #555;">
                                ${orderItemsHtml}
                            </ul>
                        </div>
                        <div class="order-total">
                            T·ªïng thanh to√°n: ${formatCurrency(order.total)}
                        </div>
                        <div style="text-align: right; margin-top: 10px;">
                            ${order.status === 'pending' ?
                                `<button class="delete-btn" style="background-color: #e74c3c; width: auto; padding: 8px 15px;" onclick="cancelOrder(${order.id})">
                                    <i class="fas fa-times-circle"></i> H·ªßy ƒê∆°n
                                </button>` : ''
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * X·ª≠ l√Ω khi ng∆∞·ªùi d√πng click v√†o n√∫t filter tr·∫°ng th√°i ƒë∆°n h√†ng (User View)
         * @param {string} status - Tr·∫°ng th√°i c·∫ßn l·ªçc
         * @param {HTMLElement} buttonElement - N√∫t ƒë∆∞·ª£c click
         */
        function filterOrders(status, buttonElement) {
            document.querySelectorAll('#userOrderStatusFilter .status-btn').forEach(btn => btn.classList.remove('active'));
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            // Render l·∫°i danh s√°ch ƒë∆°n h√†ng
            renderOrders(status);
        }

        /**
         * H·ªßy ƒë∆°n h√†ng (User View)
         * @param {number} orderId - ID c·ªßa ƒë∆°n h√†ng c·∫ßn h·ªßy
         */
        function cancelOrder(orderId) {
            const orderIndex = sampleOrders.findIndex(o => o.id === orderId);
            if (orderIndex > -1) {
                if (sampleOrders[orderIndex].status !== 'pending' && sampleOrders[orderIndex].status !== 'confirmed') {
                    showToast("Ch·ªâ c√≥ th·ªÉ h·ªßy ƒë∆°n h√†ng ƒëang Ch·ªù x√°c nh·∫≠n ho·∫∑c ƒê√£ x√°c nh·∫≠n.", 'error');
                    return;
                }

                if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë∆°n h√†ng #${orderId.toString().padStart(6, '0')}?`)) {
                    sampleOrders[orderIndex].status = 'cancelled';
                    sampleOrders[orderIndex].statusText = 'ƒê√£ h·ªßy';
                    localStorage.setItem('sampleOrders', JSON.stringify(sampleOrders));
                    showToast(`ƒê∆°n h√†ng #${orderId.toString().padStart(6, '0')} ƒë√£ ƒë∆∞·ª£c h·ªßy.`, 'success');

                    // Render l·∫°i danh s√°ch ƒë∆°n h√†ng theo filter hi·ªán t·∫°i
                    const activeFilterBtn = document.querySelector('#userOrderStatusFilter .status-btn.active');
                    const currentFilter = activeFilterBtn ? activeFilterBtn.getAttribute('data-status') : 'all';
                    renderOrders(currentFilter);
                }
            }
        }

        // --- 8. ADMIN FUNCTIONS ---

        function showAdminContent(targetId, element) {
            document.querySelectorAll('.admin-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.admin-nav-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(targetId).classList.add('active');
            element.classList.add('active');

            // Render content based on tab
            if (targetId === 'admin-orders') {
                const defaultAdminStatusBtn = document.querySelector('#adminOrderStatusFilter .status-btn[data-status="all"]');
                if (defaultAdminStatusBtn) {
                    defaultAdminStatusBtn.classList.add('active');
                }
                renderAdminOrders('all');
            } else if (targetId === 'admin-products') {
                renderAdminProducts();
            } else if (targetId === 'admin-users') {
                renderAdminUsers();
            } else if (targetId === 'admin-store-info') {
                // T·∫£i th√¥ng tin c·ª≠a h√†ng hi·ªán t·∫°i n·∫øu c·∫ßn
                // const storeInfo = JSON.parse(localStorage.getItem('store_info')) || {};
                // document.getElementById('storeName').value = storeInfo.name || 'E-commerce Demo Shop';
                // ...
            }
        }

        // --- Admin: Qu·∫£n l√Ω Th√¥ng tin C·ª≠a H√†ng ---

        function handleUpdateStoreInfo(event) {
            event.preventDefault();
            const storeName = document.getElementById('storeName').value;
            const storeHotline = document.getElementById('storeHotline').value;
            const storeAddress = document.getElementById('storeAddress').value;

            // L∆∞u th√¥ng tin v√†o localStorage n·∫øu c·∫ßn, ·ªü ƒë√¢y ch·ªâ l√† demo
            // localStorage.setItem('store_info', JSON.stringify({ name: storeName, hotline: storeHotline, address: storeAddress }));

            showToast("ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin c·ª≠a h√†ng th√†nh c√¥ng!", 'success');
            return false;
        }

        // --- Admin: Qu·∫£n l√Ω ƒê∆°n H√†ng ---

        function renderAdminOrders(filterStatus = 'all') {
            const container = document.getElementById('adminOrderListContainer');
            if (!container) return;

            // 1. L·ªçc theo tr·∫°ng th√°i
            let finalFilteredOrders = sampleOrders.slice(); // Copy m·∫£ng
            if (filterStatus !== 'all') {
                finalFilteredOrders = sampleOrders.filter(order => order.status === filterStatus);
            }
            // S·∫Øp x·∫øp ng∆∞·ª£c l·∫°i theo ID (ƒë∆°n h√†ng m·ªõi nh·∫•t l√™n ƒë·∫ßu)
            finalFilteredOrders.sort((a, b) => b.id - a.id);


            if (finalFilteredOrders.length === 0) {
                container.innerHTML = '<p style="text-align: center; margin-top: 30px; font-size: 1.1em; color: #777;">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o ·ªü tr·∫°ng th√°i n√†y.</p>';
                return;
            }

            container.innerHTML = finalFilteredOrders.map(order => {
                const statusInfo = orderStatusMap.find(s => s.id === order.status);
                const statusClass = `status-${order.status}`;
                const orderItemsHtml = order.items.map(item =>
                    `<li>${item.name} x ${item.quantity} (${formatCurrency(item.price)})</li>`
                ).join('');

                return `
                    <div class="order-item">
                        <div class="order-header">
                            <span class="order-id">ƒê∆°n h√†ng #${order.id.toString().padStart(6, '0')} (Kh√°ch: ${order.userId})</span>
                            <span class="order-status ${statusClass}">
                                <i class="fas fa-info-circle"></i> ${statusInfo ? statusInfo.text : order.statusText}
                            </span>
                        </div>
                        <div class="order-details">
                            <p><strong>Ng√†y ƒë·∫∑t:</strong> ${order.date}</p>
                            <p><strong>Ng∆∞·ªùi nh·∫≠n:</strong> ${order.recipient} - ${order.phone}</p>
                            <p><strong>ƒê·ªãa ch·ªâ:</strong> ${order.address}</p>
                            <p><strong>Ph∆∞∆°ng th·ª©c:</strong> ${order.paymentMethod === 'COD' ? 'COD' : 'Chuy·ªÉn kho·∫£n'}</p>
                            <p><strong>S·∫£n ph·∫©m:</strong></p>
                            <ul style="list-style: none; padding-left: 20px; font-size: 0.9em; color: #555;">
                                ${orderItemsHtml}
                            </ul>
                        </div>
                        <div class="order-total">
                            T·ªïng thanh to√°n: ${formatCurrency(order.total)}
                        </div>
                        <div style="text-align: right; margin-top: 10px;">
                            <label for="status-change-${order.id}">C·∫≠p nh·∫≠t Tr·∫°ng th√°i:</label>
                            <select id="status-change-${order.id}" class="status-dropdown" onchange="updateOrderStatus(${order.id}, this.value)">
                                ${orderStatusMap.map(s =>
                                    `<option value="${s.id}" ${order.status === s.id ? 'selected' : ''}>${s.text}</option>`
                                ).join('')}
                            </select>
                            ${order.status !== 'cancelled' ?
                                `<button class="delete-btn" style="background-color: #e74c3c; width: auto; padding: 8px 15px; margin-left: 10px;" onclick="cancelAdminOrder(${order.id})">
                                    <i class="fas fa-times-circle"></i> H·ªßy ƒê∆°n
                                </button>` : ''
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterAdminOrders(status, buttonElement) {
            document.querySelectorAll('#adminOrderStatusFilter .status-btn').forEach(btn => btn.classList.remove('active'));
            if (buttonElement) {
                buttonElement.classList.add('active');
            }
            renderAdminOrders(status);
        }

        function updateOrderStatus(orderId, newStatus) {
            const orderIndex = sampleOrders.findIndex(o => o.id === orderId);
            if (orderIndex > -1) {
                const statusInfo = orderStatusMap.find(s => s.id === newStatus);
                sampleOrders[orderIndex].status = newStatus;
                sampleOrders[orderIndex].statusText = statusInfo ? statusInfo.text : newStatus;
                localStorage.setItem('sampleOrders', JSON.stringify(sampleOrders));
                showToast(`ƒê√£ c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng #${orderId.toString().padStart(6, '0')} th√†nh "${statusInfo.text}".`, 'success');

                // Render l·∫°i danh s√°ch ƒë∆°n h√†ng theo filter hi·ªán t·∫°i
                const activeFilterBtn = document.querySelector('#adminOrderStatusFilter .status-btn.active');
                if (activeFilterBtn) {
                    renderAdminOrders(activeFilterBtn.getAttribute('data-status'));
                }
            }
        }

        function cancelAdminOrder(orderId) {
            const orderIndex = sampleOrders.findIndex(o => o.id === orderId);
            if (orderIndex > -1) {
                if (confirm(`Admin: B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën H·ª¶Y ƒë∆°n h√†ng #${orderId.toString().padStart(6, '0')}?`)) {
                    sampleOrders[orderIndex].status = 'cancelled';
                    sampleOrders[orderIndex].statusText = 'ƒê√£ h·ªßy';
                    localStorage.setItem('sampleOrders', JSON.stringify(sampleOrders));
                    showToast(`ƒê∆°n h√†ng #${orderId.toString().padStart(6, '0')} ƒë√£ ƒë∆∞·ª£c H·ª¶Y.`, 'error');

                    // Render l·∫°i danh s√°ch ƒë∆°n h√†ng theo filter hi·ªán t·∫°i
                    const activeFilterBtn = document.querySelector('#adminOrderStatusFilter .status-btn.active');
                    if (activeFilterBtn) {
                        renderAdminOrders(activeFilterBtn.getAttribute('data-status'));
                    }
                }
            }
        }


        // --- Admin: Qu·∫£n l√Ω H√†ng H√≥a (CRUD) ---

        function renderAdminProducts() {
            const tbody = document.getElementById('adminProductTableBody');
            if (!tbody) return;

            tbody.innerHTML = productData.map(product => `
                <tr>
                    <td>${product.id}</td>
                    <td><img src="${product.img}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;"></td>
                    <td>${product.name}</td>
                    <td>${product.category} / ${product.subCategory}</td>
                    <td>${formatCurrency(product.price)}</td>
                    <td>
                        <button class="edit-btn" onclick="openProductModal('edit', ${product.id})"><i class="fas fa-edit"></i> S·ª≠a</button>
                        <button class="delete-btn" onclick="deleteProduct(${product.id})"><i class="fas fa-trash"></i> X√≥a</button>
                    </td>
                </tr>
            `).join('');
        }

        function renderProductSubCategories(mainCategory, selectedSubCategory = '') {
            const subCategorySelect = document.getElementById('productSubCategory');
            subCategorySelect.innerHTML = '<option value="">-- Ch·ªçn Danh M·ª•c Ph·ª• --</option>';

            if (categoryMap[mainCategory]) {
                categoryMap[mainCategory].filter(c => c.id !== 'all').forEach(sub => {
                    const selected = sub.id === selectedSubCategory ? 'selected' : '';
                    subCategorySelect.innerHTML += `<option value="${sub.id}" ${selected}>${sub.name}</option>`;
                });
            }
        }

        function openProductModal(mode, productId = null) {
            const title = document.getElementById('productModalTitle');
            const saveBtn = document.getElementById('productModalSaveBtn');
            const form = document.getElementById('productForm');
            form.reset();
            document.getElementById('productIdHidden').value = '';

            if (mode === 'add') {
                title.textContent = 'Th√™m S·∫£n Ph·∫©m M·ªõi';
                saveBtn.textContent = 'Th√™m S·∫£n Ph·∫©m';
            } else if (mode === 'edit' && productId !== null) {
                title.textContent = 'Ch·ªânh S·ª≠a S·∫£n Ph·∫©m';
                saveBtn.textContent = 'C·∫≠p Nh·∫≠t S·∫£n Ph·∫©m';

                const product = productData.find(p => p.id === productId);
                if (product) {
                    document.getElementById('productIdHidden').value = product.id;
                    document.getElementById('productName').value = product.name;
                    document.getElementById('productPrice').value = product.price;
                    document.getElementById('productCategory').value = product.category;
                    renderProductSubCategories(product.category, product.subCategory);
                    document.getElementById('productImg').value = product.img;
                }
            }
            document.getElementById('productModal').style.display = 'flex';
        }

        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function handleSaveProduct(event) {
            event.preventDefault();

            const id = document.getElementById('productIdHidden').value;
            const name = document.getElementById('productName').value.trim();
            const price = parseInt(document.getElementById('productPrice').value);
            const category = document.getElementById('productCategory').value;
            const subCategory = document.getElementById('productSubCategory').value;
            const img = document.getElementById('productImg').value.trim();

            if (!name || isNaN(price) || price <= 0 || !category || !subCategory || !img) {
                showToast("Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß v√† ch√≠nh x√°c th√¥ng tin s·∫£n ph·∫©m.", 'error');
                return false;
            }

            if (id) {
                // Edit existing product
                const productIndex = productData.findIndex(p => p.id === parseInt(id));
                if (productIndex > -1) {
                    productData[productIndex].name = name;
                    productData[productIndex].price = price;
                    productData[productIndex].category = category;
                    productData[productIndex].subCategory = subCategory;
                    productData[productIndex].img = img;
                    showToast(`ƒê√£ c·∫≠p nh·∫≠t s·∫£n ph·∫©m ID #${id} th√†nh c√¥ng.`, 'success');
                }
            } else {
                // Add new product
                const newId = productData.length > 0 ? Math.max(...productData.map(p => p.id)) + 1 : 1;
                const newProduct = { id: newId, name, price, img, category, subCategory };
                productData.push(newProduct);
                showToast(`ƒê√£ th√™m s·∫£n ph·∫©m "${name}" th√†nh c√¥ng.`, 'success');
            }

            localStorage.setItem('productData', JSON.stringify(productData));
            closeProductModal();
            renderAdminProducts();
            // C·∫ßn render l·∫°i Product Grid n·∫øu ƒëang ·ªü trang s·∫£n ph·∫©m (ƒë·ªÉ ki·ªÉm tra)
            const mainCategoryBtn = document.querySelector('#productsCategoryFilter .category-btn.active');
            if (mainCategoryBtn) {
                const currentMainCategory = mainCategoryBtn.getAttribute('data-category');
                const currentSubCategoryBtn = document.querySelector('.products-sub-category-filter .subcategory-btn.active');
                const currentSubCategory = currentSubCategoryBtn ? currentSubCategoryBtn.getAttribute('data-subcategory') : 'all';
                renderProducts(currentMainCategory, currentSubCategory);
            }

            return false;
        }

        function deleteProduct(productId) {
            if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m ID #${productId} n√†y? Thao t√°c n√†y kh√¥ng th·ªÉ ho√†n t√°c.`)) {
                const productIndex = productData.findIndex(p => p.id === productId);
                if (productIndex > -1) {
                    productData.splice(productIndex, 1);
                    localStorage.setItem('productData', JSON.stringify(productData));
                    showToast(`ƒê√£ x√≥a s·∫£n ph·∫©m ID #${productId} th√†nh c√¥ng.`, 'error');
                    renderAdminProducts();
                }
            }
        }

        // --- Admin: Qu·∫£n l√Ω Th√¥ng tin T√†i kho·∫£n Kh√°ch h√†ng --- 
        
        /**
         * H√†m hi·ªÉn th·ªã danh s√°ch kh√°ch h√†ng (tr·ª´ Admin)
         */
        function renderAdminUsers() {
            const tbody = document.getElementById('adminUserTableBody');
            if (!tbody) return;
            let userList = [];
            
            // L·∫•y danh s√°ch t√†i kho·∫£n t·ª´ localStorage
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('user_')) {
                    const user = JSON.parse(localStorage.getItem(key));
                    if (!user.isAdmin) { // Ch·ªâ l·∫•y t√†i kho·∫£n kh√¥ng ph·∫£i Admin
                        userList.push(user);
                    }
                }
            }

            if (userList.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #777;">Ch∆∞a c√≥ t√†i kho·∫£n kh√°ch h√†ng n√†o ƒë∆∞·ª£c ƒëƒÉng k√Ω.</td></tr>';
                return;
            }

            // Render danh s√°ch v·ªõi n√∫t Ki·ªÉm tra (View) v√† X√≥a (Delete)
            tbody.innerHTML = userList.map((user, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${user.username}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>
                        <button class="edit-btn" style="background-color: #f77f00;" onclick="openUserDetailModal('${user.username}')">
                            <i class="fas fa-eye"></i> Ki·ªÉm tra
                        </button>
                        <button class="delete-btn" onclick="deleteUser('${user.username}', '${user.name}')">
                            <i class="fas fa-trash"></i> X√≥a
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        /**
         * M·ªü modal hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt c·ªßa m·ªôt kh√°ch h√†ng (ch·ª©c nƒÉng Ki·ªÉm tra).
         * Bao g·ªìm c√°c th√¥ng tin c√° nh√¢n: T√™n, Username, Email, S·ªë ƒëi·ªán tho·∫°i, Avatar.
         * @param {string} username - T√™n ƒëƒÉng nh·∫≠p c·ªßa kh√°ch h√†ng.
         */
        function openUserDetailModal(username) {
            const userString = localStorage.getItem('user_' + username);
            if (!userString) {
                showToast(`Kh√¥ng t√¨m th·∫•y th√¥ng tin kh√°ch h√†ng ${username}.`, 'error');
                return;
            }

            const user = JSON.parse(userString);

            document.getElementById('userAvatarModal').src = user.avatar;
            document.getElementById('userNameDetail').textContent = user.name;
            document.getElementById('userUsernameDetail').textContent = user.username;
            document.getElementById('userEmailDetail').textContent = user.email;
            document.getElementById('userPhoneDetail').textContent = user.phone;

            document.getElementById('userDetailModal').style.display = 'flex';
        }

        /**
         * X√≥a t√†i kho·∫£n c·ªßa m·ªôt kh√°ch h√†ng.
         * @param {string} username - T√™n ƒëƒÉng nh·∫≠p c·ªßa kh√°ch h√†ng.
         * @param {string} name - T√™n hi·ªÉn th·ªã c·ªßa kh√°ch h√†ng.
         */
        function deleteUser(username, name) {
            if (confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√†i kho·∫£n "${name}" (${username})? Thao t√°c n√†y kh√¥ng th·ªÉ ho√†n t√°c.`)) {
                
                // X√≥a t√†i kho·∫£n kh·ªèi localStorage
                localStorage.removeItem('user_' + username);

                // X·ª≠ l√Ω n·∫øu t√†i kho·∫£n b·ªã x√≥a l√† t√†i kho·∫£n ƒëang ƒëƒÉng nh·∫≠p
                if (currentUser && currentUser.username === username) {
                    // T·ª± ƒë·ªông ƒëƒÉng xu·∫•t ng∆∞·ªùi d√πng ƒë√≥
                    handleLogout(); 
                }

                showToast(`ƒê√£ x√≥a t√†i kho·∫£n "${name}" th√†nh c√¥ng.`, 'success');

                // Render l·∫°i danh s√°ch kh√°ch h√†ng tr√™n b·∫£ng ƒëi·ªÅu khi·ªÉn Admin
                renderAdminUsers();
            }
        }


        // --- 9. INIT ---

        window.addEventListener('load', () => {
            // Kh·ªüi t·∫°o danh m·ª•c s·∫£n ph·∫©m
            renderMainCategories();

            // Kh·ªüi t·∫°o tr·∫°ng th√°i ƒëƒÉng nh·∫≠p t·ª´ localStorage (n·∫øu c√≥)
            const lastLoggedInUser = localStorage.getItem('lastLoggedInUser');
            if (lastLoggedInUser) {
                 const storedUserString = localStorage.getItem('user_' + lastLoggedInUser);
                 if (storedUserString) {
                    currentUser = JSON.parse(storedUserString);
                    isLoggedIn = true;
                 } else if (lastLoggedInUser === 'admin') {
                     // T·∫£i l·∫°i th√¥ng tin admin n·∫øu c·∫ßn
                     currentUser = {
                        name: "Admin",
                        email: "admin@shop.com",
                        username: 'admin',
                        isAdmin: true,
                        avatar: 'https://via.placeholder.com/100/F77F00/FFFFFF?text=ADMIN'
                    };
                    isLoggedIn = true;
                    // X·ª≠ l√Ω giao di·ªán Admin n·∫øu admin ƒëƒÉng nh·∫≠p
                    headerBottom.style.display = 'none';
                    categoryBar.style.display = 'none';
                    document.body.style.backgroundColor = '#e9ecef';
                 }
            }
            updateHeaderStatus();

            // Kh·ªüi t·∫°o hi·ªÉn th·ªã Trang Ch·ªß n·∫øu kh√¥ng ph·∫£i Admin
            if (!currentUser || !currentUser.isAdmin) {
                 showContent('home-section', document.getElementById('nav-home'));
            }
        });
    </script>
</body>
</html>
